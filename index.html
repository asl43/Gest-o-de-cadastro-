<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema de Cadastro Familiar</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

:root {
  --primary: #6366f1;
  --primary-dark: #4f46e5;
  --secondary: #ec4899;
  --success: #10b981;
  --danger: #ef4444;
  --warning: #f59e0b;
  --dark: #1e293b;
  --light: #f8fafc;
  --gray: #64748b;
  --shadow: 0 10px 40px rgba(0,0,0,0.1);
  --shadow-lg: 0 20px 60px rgba(0,0,0,0.15);
}

body {
  font-family: 'Poppins', sans-serif;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  min-height: 100vh;
  padding: 20px;
  overflow-x: hidden;
}

/* =============== ANIMA√á√ÉO DE LOADING =============== */
.loading-screen {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  z-index: 10000;
  animation: fadeOut 1s ease 2.5s forwards;
}

@keyframes fadeOut {
  to {
    opacity: 0;
    visibility: hidden;
  }
}

.logo-animation {
  font-family: 'Playfair Display', serif;
  font-size: 4em;
  font-weight: 900;
  color: white;
  text-shadow: 0 5px 30px rgba(0,0,0,0.3);
  animation: logoFloat 1.5s ease-in-out infinite;
  margin-bottom: 30px;
}

@keyframes logoFloat {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

.loading-text {
  color: white;
  font-size: 1.2em;
  font-weight: 300;
  letter-spacing: 3px;
  animation: pulse 1.5s ease-in-out infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 0.4; }
  50% { opacity: 1; }
}

.spinner {
  width: 60px;
  height: 60px;
  border: 4px solid rgba(255,255,255,0.3);
  border-top-color: white;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin-top: 30px;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* =============== CONTAINER PRINCIPAL =============== */
.container {
  max-width: 1400px;
  margin: 0 auto;
  opacity: 0;
  animation: slideInUp 0.8s ease 3s forwards;
}

@keyframes slideInUp {
  from {
    opacity: 0;
    transform: translateY(50px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* =============== HEADER =============== */
.header {
  text-align: center;
  margin-bottom: 40px;
}

.header h1 {
  font-family: 'Playfair Display', serif;
  font-size: 3.5em;
  font-weight: 900;
  color: white;
  text-shadow: 0 5px 30px rgba(0,0,0,0.2);
  margin-bottom: 10px;
  letter-spacing: -1px;
}

.header p {
  color: rgba(255,255,255,0.9);
  font-size: 1.1em;
  font-weight: 300;
}

/* =============== ESTAT√çSTICAS R√ÅPIDAS =============== */
.stats-bar {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}

.stat-card {
  background: white;
  padding: 25px;
  border-radius: 20px;
  box-shadow: var(--shadow);
  text-align: center;
  transition: all 0.3s;
}

.stat-card:hover {
  transform: translateY(-5px);
  box-shadow: var(--shadow-lg);
}

.stat-number {
  font-size: 2.5em;
  font-weight: 700;
  color: var(--primary);
  margin-bottom: 5px;
}

.stat-label {
  font-size: 0.9em;
  color: var(--gray);
  font-weight: 500;
}

.stat-icon {
  font-size: 2em;
  margin-bottom: 10px;
}

/* =============== NAVEGA√á√ÉO =============== */
.nav-tabs {
  display: flex;
  gap: 15px;
  margin-bottom: 30px;
  background: rgba(255,255,255,0.1);
  padding: 10px;
  border-radius: 20px;
  backdrop-filter: blur(10px);
}

.nav-tab {
  flex: 1;
  padding: 15px 30px;
  background: transparent;
  border: 2px solid transparent;
  border-radius: 15px;
  color: white;
  font-size: 1em;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
}

.nav-tab:hover {
  background: rgba(255,255,255,0.1);
  transform: translateY(-2px);
}

.nav-tab.active {
  background: white;
  color: var(--primary);
  box-shadow: var(--shadow);
}

/* =============== CONTE√öDO =============== */
.content-section {
  display: none;
  animation: fadeInContent 0.5s ease;
}

.content-section.active {
  display: block;
}

@keyframes fadeInContent {
  from {
    opacity: 0;
    transform: scale(0.95);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

/* =============== FORMUL√ÅRIO =============== */
.form-card {
  background: white;
  padding: 40px;
  border-radius: 25px;
  box-shadow: var(--shadow-lg);
  margin-bottom: 30px;
}

.form-title {
  font-size: 2em;
  font-weight: 700;
  color: var(--dark);
  margin-bottom: 30px;
  display: flex;
  align-items: center;
  gap: 15px;
}

.form-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  margin-bottom: 20px;
}

.form-group {
  display: flex;
  flex-direction: column;
}

.form-group label {
  font-size: 0.9em;
  font-weight: 600;
  color: var(--dark);
  margin-bottom: 8px;
  display: flex;
  align-items: center;
  gap: 5px;
}

.required {
  color: var(--danger);
}

.form-group input,
.form-group select,
.form-group textarea {
  padding: 14px 18px;
  border: 2px solid #e2e8f0;
  border-radius: 12px;
  font-size: 1em;
  font-family: 'Poppins', sans-serif;
  transition: all 0.3s;
  background: #f8fafc;
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
  outline: none;
  border-color: var(--primary);
  background: white;
  box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
}

.form-group textarea {
  resize: vertical;
  min-height: 100px;
}

/* =============== BOT√ïES =============== */
.btn {
  padding: 16px 32px;
  border: none;
  border-radius: 12px;
  font-size: 1em;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  display: inline-flex;
  align-items: center;
  gap: 10px;
  justify-content: center;
  font-family: 'Poppins', sans-serif;
}

.btn-primary {
  background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
  color: white;
  box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 25px rgba(99, 102, 241, 0.5);
}

.btn-secondary {
  background: var(--gray);
  color: white;
}

.btn-secondary:hover {
  background: #475569;
}

.btn-success {
  background: var(--success);
  color: white;
}

.btn-danger {
  background: var(--danger);
  color: white;
}

.btn-warning {
  background: var(--warning);
  color: white;
}

.btn-sm {
  padding: 8px 16px;
  font-size: 0.85em;
}

.btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none !important;
}

/* =============== TABELA =============== */
.table-card {
  background: white;
  padding: 30px;
  border-radius: 25px;
  box-shadow: var(--shadow-lg);
  overflow: hidden;
}

.table-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 25px;
  flex-wrap: wrap;
  gap: 15px;
}

.table-title {
  font-size: 1.8em;
  font-weight: 700;
  color: var(--dark);
}

.search-box {
  padding: 12px 20px;
  border: 2px solid #e2e8f0;
  border-radius: 12px;
  font-size: 0.95em;
  width: 300px;
  transition: all 0.3s;
}

.search-box:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
}

.table-wrapper {
  overflow-x: auto;
}

table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
}

thead {
  background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
}

th {
  padding: 18px 15px;
  text-align: left;
  color: white;
  font-weight: 600;
  font-size: 0.9em;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

th:first-child {
  border-top-left-radius: 12px;
}

th:last-child {
  border-top-right-radius: 12px;
}

tbody tr {
  transition: all 0.3s;
  background: white;
  border-bottom: 1px solid #f1f5f9;
}

tbody tr:hover {
  background: #f8fafc;
  transform: scale(1.01);
  box-shadow: 0 4px 12px rgba(0,0,0,0.05);
}

td {
  padding: 18px 15px;
  color: var(--dark);
  font-size: 0.95em;
}

.action-buttons {
  display: flex;
  gap: 8px;
}

.status-badge {
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 0.8em;
  font-weight: 600;
}

.status-ativo {
  background: #d1fae5;
  color: #065f46;
}

.status-inativo {
  background: #fee2e2;
  color: #991b1b;
}

/* =============== CARDS DE FAMILIARES =============== */
.cards-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
  gap: 25px;
}

.family-card {
  background: white;
  border-radius: 20px;
  padding: 30px;
  box-shadow: var(--shadow);
  cursor: pointer;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
}

.family-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 5px;
  background: linear-gradient(90deg, var(--primary), var(--secondary));
}

.family-card:hover {
  transform: translateY(-8px);
  box-shadow: var(--shadow-lg);
}

.card-avatar {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2em;
  color: white;
  margin-bottom: 20px;
  font-weight: 700;
}

.card-name {
  font-size: 1.4em;
  font-weight: 700;
  color: var(--dark);
  margin-bottom: 8px;
}

.card-info {
  font-size: 0.95em;
  color: var(--gray);
  margin-bottom: 5px;
}

.card-badge {
  display: inline-block;
  padding: 6px 14px;
  background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(236, 72, 153, 0.1));
  color: var(--primary);
  border-radius: 20px;
  font-size: 0.85em;
  font-weight: 600;
  margin-top: 10px;
}

/* =============== ANIVERS√ÅRIOS =============== */
.aniversarios-section {
  background: white;
  padding: 30px;
  border-radius: 25px;
  box-shadow: var(--shadow-lg);
  margin-bottom: 30px;
}

.aniversario-item {
  display: flex;
  align-items: center;
  gap: 20px;
  padding: 20px;
  background: #fef3c7;
  border-radius: 15px;
  margin-bottom: 15px;
  border-left: 5px solid var(--warning);
}

.aniversario-urgent {
  background: #fecaca;
  border-left-color: var(--danger);
}

.aniversario-icon {
  font-size: 2em;
}

.aniversario-info {
  flex: 1;
}

.aniversario-nome {
  font-size: 1.2em;
  font-weight: 700;
  color: var(--dark);
}

.aniversario-dias {
  font-size: 0.9em;
  color: var(--gray);
  margin-top: 5px;
}

/* =============== MODAL =============== */
.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.7);
  backdrop-filter: blur(5px);
  z-index: 1000;
  align-items: center;
  justify-content: center;
  animation: fadeIn 0.3s ease;
}

.modal.active {
  display: flex;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.modal-content {
  background: white;
  border-radius: 25px;
  padding: 40px;
  max-width: 800px;
  width: 90%;
  max-height: 90vh;
  overflow-y: auto;
  position: relative;
  animation: slideInModal 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes slideInModal {
  from {
    opacity: 0;
    transform: scale(0.9) translateY(-20px);
  }
  to {
    opacity: 1;
    transform: scale(1) translateY(0);
  }
}

.modal-close {
  position: absolute;
  top: 20px;
  right: 20px;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: #f1f5f9;
  border: none;
  font-size: 1.5em;
  cursor: pointer;
  transition: all 0.3s;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--gray);
}

.modal-close:hover {
  background: var(--danger);
  color: white;
  transform: rotate(90deg);
}

.modal-header {
  display: flex;
  align-items: center;
  gap: 20px;
  margin-bottom: 30px;
  padding-bottom: 20px;
  border-bottom: 2px solid #f1f5f9;
}

.modal-avatar {
  width: 100px;
  height: 100px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2.5em;
  color: white;
  font-weight: 700;
}

.modal-title {
  flex: 1;
}

.modal-title h2 {
  font-size: 2em;
  font-weight: 700;
  color: var(--dark);
  margin-bottom: 5px;
}

.modal-title p {
  color: var(--gray);
  font-size: 1.1em;
}

.modal-body {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 25px;
}

.info-item {
  padding: 20px;
  background: #f8fafc;
  border-radius: 15px;
  border-left: 4px solid var(--primary);
}

.info-label {
  font-size: 0.85em;
  font-weight: 600;
  color: var(--gray);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 8px;
}

.info-value {
  font-size: 1.1em;
  font-weight: 600;
  color: var(--dark);
}

.modal-footer {
  margin-top: 30px;
  padding-top: 20px;
  border-top: 2px solid #f1f5f9;
  display: flex;
  gap: 15px;
  justify-content: flex-end;
}

/* =============== NOTIFICA√á√ÉO =============== */
.notification {
  position: fixed;
  top: 20px;
  right: 20px;
  padding: 20px 30px;
  background: white;
  border-radius: 15px;
  box-shadow: var(--shadow-lg);
  display: none;
  align-items: center;
  gap: 15px;
  z-index: 2000;
  animation: slideInRight 0.4s ease;
  min-width: 300px;
}

@keyframes slideInRight {
  from {
    opacity: 0;
    transform: translateX(100px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

.notification.show {
  display: flex;
}

.notification.success {
  border-left: 5px solid var(--success);
}

.notification.error {
  border-left: 5px solid var(--danger);
}

.notification.info {
  border-left: 5px solid var(--primary);
}

.notification-icon {
  font-size: 1.5em;
}

.notification-text {
  flex: 1;
  font-weight: 600;
  color: var(--dark);
}

/* =============== LOADING INLINE =============== */
.loading-inline {
  display: none;
  text-align: center;
  padding: 40px;
  color: var(--gray);
}

.loading-inline.show {
  display: block;
}

.loading-spinner {
  width: 40px;
  height: 40px;
  border: 4px solid #f3f4f6;
  border-top-color: var(--primary);
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 0 auto 15px;
}

/* =============== RESPONSIVO =============== */
@media (max-width: 768px) {
  .header h1 {
    font-size: 2em;
  }
  
  .nav-tabs {
    flex-direction: column;
  }
  
  .form-card {
    padding: 25px;
  }
  
  .form-grid {
    grid-template-columns: 1fr;
  }
  
  .cards-grid {
    grid-template-columns: 1fr;
  }
  
  .table-header {
    flex-direction: column;
  }
  
  .search-box {
    width: 100%;
  }
  
  .modal-content {
    padding: 25px;
  }
  
  .stats-bar {
    grid-template-columns: 1fr;
  }
}

/* =============== SCROLLBAR CUSTOMIZADA =============== */
::-webkit-scrollbar {
  width: 10px;
}

::-webkit-scrollbar-track {
  background: #f1f5f9;
}

::-webkit-scrollbar-thumb {
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  border-radius: 10px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--primary-dark);
}
</style>
</head>
<body>

<!-- =============== TELA DE LOADING =============== -->
<div class="loading-screen">
  <div class="logo-animation">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</div>
  <div class="loading-text">SISTEMA FAMILIAR</div>
  <div class="spinner"></div>
</div>

<!-- =============== CONTAINER PRINCIPAL =============== -->
<div class="container">
  
  <!-- HEADER -->
  <div class="header">
    <h1>Sistema de Cadastro Familiar</h1>
    <p>Gerencie informa√ß√µes da sua fam√≠lia de forma completa e organizada</p>
  </div>

  <!-- ESTAT√çSTICAS -->
  <div class="stats-bar" id="statsBar">
    <div class="stat-card">
      <div class="stat-icon">üë•</div>
      <div class="stat-number" id="statTotal">-</div>
      <div class="stat-label">Total de Familiares</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">‚úÖ</div>
      <div class="stat-number" id="statAtivos">-</div>
      <div class="stat-label">Cadastros Ativos</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">üéÇ</div>
      <div class="stat-number" id="statAniversarios">-</div>
      <div class="stat-label">Anivers√°rios Pr√≥ximos</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">üìä</div>
      <div class="stat-number" id="statIdadeMedia">-</div>
      <div class="stat-label">Idade M√©dia</div>
    </div>
  </div>

  <!-- NAVEGA√á√ÉO -->
  <div class="nav-tabs">
    <button class="nav-tab active" onclick="mudarAba('cadastro')">
      <span>üìù</span> Cadastro
    </button>
    <button class="nav-tab" onclick="mudarAba('lista')">
      <span>üìã</span> Lista Completa
    </button>
    <button class="nav-tab" onclick="mudarAba('cards')">
      <span>üë•</span> Visualizar Familiares
    </button>
    <button class="nav-tab" onclick="mudarAba('aniversarios')">
      <span>üéÇ</span> Anivers√°rios
    </button>
  </div>

  <!-- =============== ABA CADASTRO =============== -->
  <div id="cadastro" class="content-section active">
    <div class="form-card">
      <h2 class="form-title">
        <span>üë§</span>
        <span id="formTitleText">Cadastrar Novo Familiar</span>
      </h2>
      
      <form id="familyForm">
        <input type="hidden" id="editId">
        
        <div class="form-grid">
          <div class="form-group">
            <label>Nome Completo <span class="required">*</span></label>
            <input type="text" id="nome" required placeholder="Digite o nome completo">
          </div>

          <div class="form-group">
            <label>Parentesco <span class="required">*</span></label>
            <select id="parentesco" required>
              <option value="">Selecione...</option>
              <option>Pai</option>
              <option>M√£e</option>
              <option>Filho(a)</option>
              <option>Irm√£o(√£)</option>
              <option>Av√¥(√≥)</option>
              <option>Tio(a)</option>
              <option>Primo(a)</option>
              <option>C√¥njuge</option>
              <option>Outro</option>
            </select>
          </div>

          <div class="form-group">
            <label>CPF</label>
            <input type="text" id="cpf" placeholder="000.000.000-00" maxlength="14">
          </div>

          <div class="form-group">
            <label>Data de Nascimento</label>
            <input type="date" id="nascimento">
          </div>

          <div class="form-group">
            <label>Cart√£o SUS</label>
            <input type="text" id="cartaoSus" placeholder="000 0000 0000 0000" maxlength="18">
          </div>

          <div class="form-group">
            <label>Telefone</label>
            <input type="text" id="telefone" placeholder="(00) 00000-0000" maxlength="15">
          </div>

          <div class="form-group">
            <label>Email</label>
            <input type="email" id="email" placeholder="exemplo@email.com">
          </div>

          <div class="form-group">
            <label>Profiss√£o</label>
            <input type="text" id="profissao" placeholder="Digite a profiss√£o">
          </div>

          <div class="form-group">
            <label>Estado Civil</label>
            <select id="estadoCivil">
              <option value="">Selecione...</option>
              <option>Solteiro(a)</option>
              <option>Casado(a)</option>
              <option>Divorciado(a)</option>
              <option>Vi√∫vo(a)</option>
              <option>Uni√£o Est√°vel</option>
            </select>
          </div>

          <div class="form-group">
            <label>Escolaridade</label>
            <select id="escolaridade">
              <option value="">Selecione...</option>
              <option>Fundamental Incompleto</option>
              <option>Fundamental Completo</option>
              <option>M√©dio Incompleto</option>
              <option>M√©dio Completo</option>
              <option>Superior Incompleto</option>
              <option>Superior Completo</option>
              <option>P√≥s-Gradua√ß√£o</option>
            </select>
          </div>

          <div class="form-group">
            <label>Tipo Sangu√≠neo</label>
            <select id="tipoSanguineo">
              <option value="">Selecione...</option>
              <option>A+</option>
              <option>A-</option>
              <option>B+</option>
              <option>B-</option>
              <option>AB+</option>
              <option>AB-</option>
              <option>O+</option>
              <option>O-</option>
            </select>
          </div>

          <div class="form-group">
            <label>Nacionalidade</label>
            <input type="text" id="nacionalidade" placeholder="Brasileiro(a)" value="Brasileiro(a)">
          </div>
        </div>

        <div class="form-group" style="margin-top: 20px;">
          <label>Endere√ßo Completo</label>
          <textarea id="endereco" placeholder="Rua, n√∫mero, bairro, cidade, estado, CEP"></textarea>
        </div>

        <div class="form-group">
          <label>Observa√ß√µes / Informa√ß√µes Adicionais</label>
          <textarea id="observacoes" placeholder="Alergias, condi√ß√µes de sa√∫de, prefer√™ncias, etc."></textarea>
        </div>

        <div style="display: flex; gap: 15px; margin-top: 30px;">
          <button type="submit" class="btn btn-primary" style="flex: 1;" id="btnSubmit">
            <span id="btnSubmitText">üíæ Cadastrar Familiar</span>
          </button>
          <button type="button" class="btn btn-secondary" onclick="cancelarEdicao()" id="btnCancelar" style="display: none;">
            ‚úï Cancelar
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- =============== ABA LISTA =============== -->
  <div id="lista" class="content-section">
    <div class="table-card">
      <div class="table-header">
        <h2 class="table-title">üìã Todos os Familiares</h2>
        <div style="display: flex; gap: 10px;">
          <input type="text" class="search-box" id="searchInput" placeholder="üîç Pesquisar familiar...">
          <button class="btn btn-warning btn-sm" onclick="sincronizarDados()">üîÑ Sincronizar</button>
        </div>
      </div>

      <div class="loading-inline" id="loadingTable">
        <div class="loading-spinner"></div>
        <p>Carregando dados...</p>
      </div>

      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th>Nome</th>
              <th>Parentesco</th>
              <th>CPF</th>
              <th>Nascimento</th>
              <th>Telefone</th>
              <th>Status</th>
              <th>A√ß√µes</th>
            </tr>
          </thead>
          <tbody id="tableBody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- =============== ABA CARDS =============== -->
  <div id="cards" class="content-section">
    <div class="loading-inline" id="loadingCards">
      <div class="loading-spinner"></div>
      <p>Carregando familiares...</p>
    </div>
    <div class="cards-grid" id="cardsGrid"></div>
  </div>

  <!-- =============== ABA ANIVERS√ÅRIOS =============== -->
  <div id="aniversarios" class="content-section">
    <div class="aniversarios-section">
      <h2 class="form-title">
        <span>üéÇ</span>
        <span>Anivers√°rios Pr√≥ximos</span>
      </h2>

      <div class="loading-inline" id="loadingAniversarios">
        <div class="loading-spinner"></div>
        <p>Carregando anivers√°rios...</p>
      </div>

      <div id="aniversariosList"></div>
    </div>
  </div>

</div>

<!-- =============== MODAL DE DETALHES =============== -->
<div id="modal" class="modal">
  <div class="modal-content">
    <button class="modal-close" onclick="fecharModal()">√ó</button>
    
    <div class="modal-header">
      <div class="modal-avatar" id="modalAvatar"></div>
      <div class="modal-title">
        <h2 id="modalNome"></h2>
        <p id="modalParentesco"></p>
      </div>
    </div>

    <div class="modal-body" id="modalBody"></div>

    <div class="modal-footer">
      <button class="btn btn-primary btn-sm" onclick="editarDoModal()">
        ‚úèÔ∏è Editar
      </button>
      <button class="btn btn-danger btn-sm" onclick="deletarDoModal()">
        üóëÔ∏è Excluir
      </button>
      <button class="btn btn-secondary btn-sm" onclick="fecharModal()">
        Fechar
      </button>
    </div>
  </div>
</div>

<!-- =============== NOTIFICA√á√ÉO =============== -->
<div id="notification" class="notification">
  <span class="notification-icon" id="notifIcon"></span>
  <span class="notification-text" id="notifText"></span>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbwAbTfUA-Y8r4VItTDUXNByOTfvStZWJ1GkBguWuuui7KhxZfxeS16a-bTfL4xByDVzGw/exec";

let familiares = [];
let familiarAtual = null;
let estatisticas = {};

// =============== M√ÅSCARAS ===============
document.getElementById('cpf').addEventListener('input', function(e) {
  let value = e.target.value.replace(/\D/g, '');
  if (value.length <= 11) {
    value = value.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
    e.target.value = value;
  }
});

document.getElementById('telefone').addEventListener('input', function(e) {
  let value = e.target.value.replace(/\D/g, '');
  if (value.length <= 11) {
    value = value.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
    e.target.value = value;
  }
});

document.getElementById('cartaoSus').addEventListener('input', function(e) {
  let value = e.target.value.replace(/\D/g, '');
  if (value.length <= 15) {
    value = value.replace(/(\d{3})(\d{4})(\d{4})(\d{4})/, '$1 $2 $3 $4');
    e.target.value = value;
  }
});

// =============== NAVEGA√á√ÉO ===============
function mudarAba(aba) {
  document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
  document.querySelectorAll('.content-section').forEach(section => section.classList.remove('active'));
  
  event.target.closest('.nav-tab').classList.add('active');
  document.getElementById(aba).classList.add('active');
  
  if (aba === 'lista') carregarTabela();
  if (aba === 'cards') carregarCards();
  if (aba === 'aniversarios') carregarAniversarios();
}

// =============== NOTIFICA√á√ÉO ===============
function mostrarNotificacao(mensagem, tipo = 'success') {
  const notif = document.getElementById('notification');
  const icon = document.getElementById('notifIcon');
  const text = document.getElementById('notifText');
  
  notif.className = 'notification show ' + tipo;
  
  if (tipo === 'success') icon.textContent = '‚úÖ';
  else if (tipo === 'error') icon.textContent = '‚ùå';
  else icon.textContent = '‚ÑπÔ∏è';
  
  text.textContent = mensagem;
  
  setTimeout(() => {
    notif.classList.remove('show');
  }, 4000);
}

// =============== FORMUL√ÅRIO ===============
document.getElementById('familyForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  
  const btnSubmit = document.getElementById('btnSubmit');
  btnSubmit.disabled = true;
  btnSubmit.innerHTML = '<span>‚è≥ Salvando...</span>';
  
  const editId = document.getElementById('editId').value;
  
  const dados = {
    acao: editId ? 'atualizar' : 'cadastrar',
    id: editId || Date.now(),
    nome: document.getElementById('nome').value,
    parentesco: document.getElementById('parentesco').value,
    cpf: document.getElementById('cpf').value,
    nascimento: document.getElementById('nascimento').value,
    cartaoSus: document.getElementById('cartaoSus').value,
    telefone: document.getElementById('telefone').value,
    email: document.getElementById('email').value,
    profissao: document.getElementById('profissao').value,
    estadoCivil: document.getElementById('estadoCivil').value,
    escolaridade: document.getElementById('escolaridade').value,
    tipoSanguineo: document.getElementById('tipoSanguineo').value,
    nacionalidade: document.getElementById('nacionalidade').value,
    endereco: document.getElementById('endereco').value,
    observacoes: document.getElementById('observacoes').value
  };

  try {
    const response = await fetch(API_URL, {
      method: 'POST',
      mode: 'no-cors',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify(dados)
    });

    mostrarNotificacao(
      editId ? 'Familiar atualizado com sucesso!' : 'Familiar cadastrado com sucesso!',
      'success'
    );
    
    document.getElementById('familyForm').reset();
    cancelarEdicao();
    
    setTimeout(() => {
      carregar();
      carregarEstatisticas();
    }, 1000);
    
  } catch (erro) {
    mostrarNotificacao('Dados enviados! Aguarde sincroniza√ß√£o.', 'info');
    setTimeout(() => {
      carregar();
      carregarEstatisticas();
    }, 2000);
  } finally {
    btnSubmit.disabled = false;
    btnSubmit.innerHTML = '<span id="btnSubmitText">üíæ Cadastrar Familiar</span>';
  }
});

// =============== CARREGAR DADOS ===============
async function carregar() {
  try {
    const res = await fetch(API_URL);
    const dados = await res.json();
    
    familiares = dados.slice(1).map(linha => ({
      id: linha[0],
      nome: linha[1],
      parentesco: linha[2],
      cpf: linha[3],
      nascimento: linha[4],
      idade: linha[5],
      cartaoSus: linha[6],
      telefone: linha[7],
      email: linha[8],
      profissao: linha[9],
      estadoCivil: linha[10],
      escolaridade: linha[11],
      tipoSanguineo: linha[12],
      nacionalidade: linha[13],
      endereco: linha[14],
      observacoes: linha[15],
      dataCadastro: linha[16],
      ultimaAtualizacao: linha[17],
      status: linha[18] || 'Ativo'
    })).filter(f => f.status === 'Ativo');
    
  } catch (erro) {
    console.log('Aguardando dados...');
  }
}

// =============== ESTAT√çSTICAS ===============
async function carregarEstatisticas() {
  try {
    const res = await fetch(API_URL + '?acao=estatisticas');
    estatisticas = await res.json();
    
    document.getElementById('statTotal').textContent = estatisticas.total || 0;
    document.getElementById('statAtivos').textContent = estatisticas.ativos || 0;
    document.getElementById('statAniversarios').textContent = estatisticas.aniversariantesDoMes || 0;
    document.getElementById('statIdadeMedia').textContent = estatisticas.idadeMedia ? estatisticas.idadeMedia + ' anos' : '-';
    
  } catch (erro) {
    console.log('Estat√≠sticas n√£o dispon√≠veis');
  }
}

// =============== TABELA ===============
function carregarTabela() {
  const tbody = document.getElementById('tableBody');
  const loading = document.getElementById('loadingTable');
  
  loading.classList.add('show');
  tbody.innerHTML = '';
  
  setTimeout(() => {
    loading.classList.remove('show');
    
    if (familiares.length === 0) {
      tbody.innerHTML = `
        <tr>
          <td colspan="7" style="text-align: center; padding: 40px; color: var(--gray);">
            Nenhum familiar cadastrado ainda
          </td>
        </tr>
      `;
      return;
    }
    
    familiares.forEach(f => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td><strong>${f.nome}</strong></td>
        <td>${f.parentesco}</td>
        <td>${f.cpf || '-'}</td>
        <td>${formatarData(f.nascimento)}</td>
        <td>${f.telefone || '-'}</td>
        <td><span class="status-badge status-${f.status.toLowerCase()}">${f.status}</span></td>
        <td>
          <div class="action-buttons">
            <button class="btn btn-primary btn-sm" onclick="visualizar(${f.id})" title="Visualizar">üëÅÔ∏è</button>
            <button class="btn btn-success btn-sm" onclick="editar(${f.id})" title="Editar">‚úèÔ∏è</button>
            <button class="btn btn-danger btn-sm" onclick="deletar(${f.id})" title="Excluir">üóëÔ∏è</button>
          </div>
        </td>
      `;
      tbody.appendChild(tr);
    });
  }, 500);
}

// =============== CARDS ===============
function carregarCards() {
  const grid = document.getElementById('cardsGrid');
  const loading = document.getElementById('loadingCards');
  
  loading.classList.add('show');
  grid.innerHTML = '';
  
  setTimeout(() => {
    loading.classList.remove('show');
    
    if (familiares.length === 0) {
      grid.innerHTML = `
        <div style="grid-column: 1/-1; text-align: center; padding: 60px; color: var(--gray);">
          <h3>Nenhum familiar cadastrado</h3>
          <p>V√° para a aba Cadastro para adicionar familiares</p>
        </div>
      `;
      return;
    }
    
    familiares.forEach(f => {
      const card = document.createElement('div');
      card.className = 'family-card';
      card.onclick = () => visualizar(f.id);
      
      const iniciais = f.nome.split(' ').map(n => n[0]).join('').substring(0, 2);
      
      card.innerHTML = `
        <div class="card-avatar">${iniciais}</div>
        <div class="card-name">${f.nome}</div>
        <div class="card-info">üì± ${f.telefone || 'N√£o informado'}</div>
        <div class="card-info">üìÖ ${formatarData(f.nascimento) || 'N√£o informado'}</div>
        <div class="card-info">üéÇ ${f.idade ? f.idade + ' anos' : 'Idade n√£o informada'}</div>
        <span class="card-badge">${f.parentesco}</span>
      `;
      
      grid.appendChild(card);
    });
  }, 500);
}

// =============== ANIVERS√ÅRIOS ===============
async function carregarAniversarios() {
  const lista = document.getElementById('aniversariosList');
  const loading = document.getElementById('loadingAniversarios');
  
  loading.classList.add('show');
  lista.innerHTML = '';
  
  try {
    const res = await fetch(API_URL + '?acao=aniversarios');
    const aniversarios = await res.json();
    
    loading.classList.remove('show');
    
    if (aniversarios.length === 0) {
      lista.innerHTML = `
        <div style="text-align: center; padding: 40px; color: var(--gray);">
          <h3>üéâ Nenhum anivers√°rio pr√≥ximo</h3>
          <p>N√£o h√° aniversariantes nos pr√≥ximos dias</p>
        </div>
      `;
      return;
    }
    
    aniversarios.forEach(a => {
      const div = document.createElement('div');
      div.className = a.diasRestantes <= 2 ? 'aniversario-item aniversario-urgent' : 'aniversario-item';
      
      div.innerHTML = `
        <div class="aniversario-icon">üéÇ</div>
        <div class="aniversario-info">
          <div class="aniversario-nome">${a.nome} (${a.parentesco})</div>
          <div class="aniversario-dias">
            Faz anivers√°rio em ${a.diasRestantes} ${a.diasRestantes === 1 ? 'dia' : 'dias'} 
            - Far√° ${a.idadeQueFara} anos
          </div>
        </div>
      `;
      
      lista.appendChild(div);
    });
    
  } catch (erro) {
    loading.classList.remove('show');
    lista.innerHTML = `
      <div style="text-align: center; padding: 40px; color: var(--gray);">
        <p>Erro ao carregar anivers√°rios</p>
      </div>
    `;
  }
}

// =============== MODAL ===============
function visualizar(id) {
  const familiar = familiares.find(f => f.id == id);
  if (!familiar) return;
  
  familiarAtual = familiar;
  
  const modal = document.getElementById('modal');
  const iniciais = familiar.nome.split(' ').map(n => n[0]).join('').substring(0, 2);
  
  document.getElementById('modalAvatar').textContent = iniciais;
  document.getElementById('modalNome').textContent = familiar.nome;
  document.getElementById('modalParentesco').textContent = familiar.parentesco;
  
  const modalBody = document.getElementById('modalBody');
  modalBody.innerHTML = `
    <div class="info-item">
      <div class="info-label">CPF</div>
      <div class="info-value">${familiar.cpf || 'N√£o informado'}</div>
    </div>
    <div class="info-item">
      <div class="info-label">Data de Nascimento</div>
      <div class="info-value">${formatarData(familiar.nascimento) || 'N√£o informado'}</div>
    </div>
    <div class="info-item">
      <div class="info-label">Idade</div>
      <div class="info-value">${familiar.idade ? familiar.idade + ' anos' : 'N/A'}</div>
    </div>
    <div class="info-item">
      <div class="info-label">Cart√£o SUS</div>
      <div class="info-value">${familiar.cartaoSus || 'N√£o informado'}</div>
    </div>
    <div class="info-item">
      <div class="info-label">Telefone</div>
      <div class="info-value">${familiar.telefone || 'N√£o informado'}</div>
    </div>
    <div class="info-item">
      <div class="info-label">Email</div>
      <div class="info-value">${familiar.email || 'N√£o informado'}</div>
    </div>
    <div class="info-item">
      <div class="info-label">Profiss√£o</div>
      <div class="info-value">${familiar.profissao || 'N√£o informado'}</div>
    </div>
    <div class="info-item">
      <div class="info-label">Estado Civil</div>
      <div class="info-value">${familiar.estadoCivil || 'N√£o informado'}</div>
    </div>
    <div class="info-item">
      <div class="info-label">Escolaridade</div>
      <div class="info-value">${familiar.escolaridade || 'N√£o informado'}</div>
    </div>
    <div class="info-item">
      <div class="info-label">Tipo Sangu√≠neo</div>
      <div class="info-value">${familiar.tipoSanguineo || 'N√£o informado'}</div>
    </div>
    <div class="info-item">
      <div class="info-label">Nacionalidade</div>
      <div class="info-value">${familiar.nacionalidade || 'N√£o informado'}</div>
    </div>
    <div class="info-item" style="grid-column: 1/-1;">
      <div class="info-label">Endere√ßo</div>
      <div class="info-value">${familiar.endereco || 'N√£o informado'}</div>
    </div>
    ${familiar.observacoes ? `
    <div class="info-item" style="grid-column: 1/-1;">
      <div class="info-label">Observa√ß√µes</div>
      <div class="info-value">${familiar.observacoes}</div>
    </div>
    ` : ''}
  `;
  
  modal.classList.add('active');
}

function fecharModal() {
  document.getElementById('modal').classList.remove('active');
  familiarAtual = null;
}

function editarDoModal() {
  if (familiarAtual) {
    editar(familiarAtual.id);
    fecharModal();
  }
}

function deletarDoModal() {
  if (familiarAtual) {
    deletar(familiarAtual.id);
    fecharModal();
  }
}

// =============== EDITAR ===============
function editar(id) {
  const familiar = familiares.find(f => f.id == id);
  if (!familiar) return;
  
  document.getElementById('editId').value = familiar.id;
  document.getElementById('nome').value = familiar.nome;
  document.getElementById('parentesco').value = familiar.parentesco;
  document.getElementById('cpf').value = familiar.cpf;
  document.getElementById('nascimento').value = familiar.nascimento;
  document.getElementById('cartaoSus').value = familiar.cartaoSus;
  document.getElementById('telefone').value = familiar.telefone;
  document.getElementById('email').value = familiar.email;
  document.getElementById('profissao').value = familiar.profissao;
  document.getElementById('estadoCivil').value = familiar.estadoCivil;
  document.getElementById('escolaridade').value = familiar.escolaridade;
  document.getElementById('tipoSanguineo').value = familiar.tipoSanguineo;
  document.getElementById('nacionalidade').value = familiar.nacionalidade;
  document.getElementById('endereco').value = familiar.endereco;
  document.getElementById('observacoes').value = familiar.observacoes;
  
  document.getElementById('formTitleText').textContent = 'Editar Familiar';
  document.getElementById('btnSubmitText').textContent = 'üíæ Atualizar Familiar';
  document.getElementById('btnCancelar').style.display = 'block';
  
  mudarAba('cadastro');
  document.querySelector('.nav-tab').click();
}

function cancelarEdicao() {
  document.getElementById('editId').value = '';
  document.getElementById('formTitleText').textContent = 'Cadastrar Novo Familiar';
  document.getElementById('btnSubmitText').textContent = 'üíæ Cadastrar Familiar';
  document.getElementById('btnCancelar').style.display = 'none';
  document.getElementById('familyForm').reset();
}

// =============== DELETAR ===============
async function deletar(id) {
  if (!confirm('Tem certeza que deseja excluir este familiar?')) return;
  
  mostrarNotificacao('Excluindo...', 'info');
  
  try {
    await fetch(API_URL, {
      method: 'POST',
      mode: 'no-cors',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ acao: 'deletar', id: id })
    });
    
    mostrarNotificacao('Familiar exclu√≠do com sucesso!', 'success');
    
    setTimeout(() => {
      carregar();
      carregarEstatisticas();
    }, 1000);
    
  } catch (erro) {
    mostrarNotificacao('Solicita√ß√£o enviada! Aguarde sincroniza√ß√£o.', 'info');
    setTimeout(() => {
      carregar();
      carregarEstatisticas();
    }, 2000);
  }
}

// =============== SINCRONIZAR ===============
async function sincronizarDados() {
  mostrarNotificacao('Sincronizando dados...', 'info');
  
  await carregar();
  await carregarEstatisticas();
  carregarTabela();
  
  mostrarNotificacao('Dados sincronizados!', 'success');
}

// =============== PESQUISA ===============
document.getElementById('searchInput').addEventListener('input', function(e) {
  const termo = e.target.value.toLowerCase();
  const linhas = document.querySelectorAll('#tableBody tr');
  
  linhas.forEach(linha => {
    const texto = linha.textContent.toLowerCase();
    linha.style.display = texto.includes(termo) ? '' : 'none';
  });
});

// =============== UTILIDADES ===============
function formatarData(data) {
  if (!data) return '';
  const d = new Date(data + 'T00:00:00');
  return d.toLocaleDateString('pt-BR');
}

// =============== INICIALIZAR ===============
async function inicializar() {
  await carregar();
  await carregarEstatisticas();
  carregarTabela();
}

// Auto-iniciar ap√≥s anima√ß√£o
setTimeout(() => {
  inicializar();
}, 3500);
</script>

</body>
</html>
