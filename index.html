<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema Familiar Completo</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

:root {
  --primary: #6366f1;
  --primary-dark: #4f46e5;
  --secondary: #ec4899;
  --success: #10b981;
  --danger: #ef4444;
  --warning: #f59e0b;
  --info: #3b82f6;
  --dark: #1e293b;
  --light: #f8fafc;
  --gray: #64748b;
  --shadow: 0 10px 40px rgba(0,0,0,0.1);
  --shadow-lg: 0 20px 60px rgba(0,0,0,0.15);
  
  --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  --card-bg: #ffffff;
  --text-color: #1e293b;
  --text-secondary: #64748b;
  --input-bg: #f8fafc;
  --input-border: #e2e8f0;
}

body.dark-mode {
  --bg-gradient: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
  --card-bg: #1e293b;
  --text-color: #f1f5f9;
  --text-secondary: #94a3b8;
  --input-bg: #0f172a;
  --input-border: #334155;
}

body {
  font-family: 'Poppins', sans-serif;
  background: var(--bg-gradient);
  min-height: 100vh;
  padding: 20px;
  overflow-x: hidden;
  color: var(--text-color);
  transition: all 0.3s ease;
}

/* =============== STATUS BADGES =============== */
.status-badge {
  display: inline-block;
  padding: 6px 14px;
  border-radius: 20px;
  font-size: 0.85em;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.status-agendado {
  background: #dbeafe;
  color: #1e40af;
}

.status-aguardando {
  background: #fef3c7;
  color: #92400e;
}

.status-realizado {
  background: #d1fae5;
  color: #065f46;
}

.status-cancelado {
  background: #fee2e2;
  color: #991b1b;
}

/* =============== LOADING =============== */
.loading-screen {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: var(--bg-gradient);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  z-index: 10000;
  animation: fadeOut 1s ease 2.5s forwards;
}

@keyframes fadeOut {
  to {
    opacity: 0;
    visibility: hidden;
  }
}

.logo-animation {
  font-family: 'Playfair Display', serif;
  font-size: 4em;
  font-weight: 900;
  color: white;
  text-shadow: 0 5px 30px rgba(0,0,0,0.3);
  animation: logoFloat 1.5s ease-in-out infinite;
  margin-bottom: 30px;
}

@keyframes logoFloat {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

.loading-text {
  color: white;
  font-size: 1.2em;
  font-weight: 300;
  letter-spacing: 3px;
  animation: pulse 1.5s ease-in-out infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 0.4; }
  50% { opacity: 1; }
}

.spinner {
  width: 60px;
  height: 60px;
  border: 4px solid rgba(255,255,255,0.3);
  border-top-color: white;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin-top: 30px;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* =============== CONTAINER =============== */
.container {
  max-width: 1400px;
  margin: 0 auto;
  opacity: 0;
  animation: slideInUp 0.8s ease 3s forwards;
}

@keyframes slideInUp {
  from {
    opacity: 0;
    transform: translateY(50px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* =============== HEADER =============== */
.header {
  text-align: center;
  margin-bottom: 40px;
  position: relative;
}

.header h1 {
  font-family: 'Playfair Display', serif;
  font-size: 3.5em;
  font-weight: 900;
  color: white;
  text-shadow: 0 5px 30px rgba(0,0,0,0.2);
  margin-bottom: 10px;
  letter-spacing: -1px;
}

.header p {
  color: rgba(255,255,255,0.9);
  font-size: 1.1em;
  font-weight: 300;
}

/* =============== CONTROLES =============== */
.control-buttons {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 1000;
  display: flex;
  gap: 10px;
}

.btn-control {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  border: none;
  background: var(--card-bg);
  color: var(--text-color);
  font-size: 1.3em;
  cursor: pointer;
  box-shadow: var(--shadow);
  transition: all 0.3s;
  display: flex;
  align-items: center;
  justify-content: center;
}

.btn-control:hover {
  transform: translateY(-3px);
  box-shadow: var(--shadow-lg);
}

/* =============== ESTAT√çSTICAS =============== */
.stats-bar {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}

.stat-card {
  background: var(--card-bg);
  padding: 25px;
  border-radius: 20px;
  box-shadow: var(--shadow);
  text-align: center;
  transition: all 0.3s;
}

.stat-card:hover {
  transform: translateY(-5px);
  box-shadow: var(--shadow-lg);
}

.stat-number {
  font-size: 2.5em;
  font-weight: 700;
  color: var(--primary);
  margin-bottom: 5px;
}

.stat-label {
  font-size: 0.9em;
  color: var(--text-secondary);
  font-weight: 500;
}

.stat-icon {
  font-size: 2em;
  margin-bottom: 10px;
}

/* =============== NAVEGA√á√ÉO =============== */
.nav-tabs {
  display: flex;
  gap: 10px;
  margin-bottom: 30px;
  background: rgba(255,255,255,0.1);
  padding: 10px;
  border-radius: 20px;
  backdrop-filter: blur(10px);
  flex-wrap: wrap;
}

.nav-tab {
  flex: 1;
  min-width: 150px;
  padding: 15px 25px;
  background: transparent;
  border: 2px solid transparent;
  border-radius: 15px;
  color: white;
  font-size: 0.95em;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.nav-tab:hover {
  background: rgba(255,255,255,0.1);
  transform: translateY(-2px);
}

.nav-tab.active {
  background: white;
  color: var(--primary);
  box-shadow: var(--shadow);
}

/* =============== CONTE√öDO =============== */
.content-section {
  display: none;
  animation: fadeInContent 0.5s ease;
}

.content-section.active {
  display: block;
}

@keyframes fadeInContent {
  from {
    opacity: 0;
    transform: scale(0.95);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

/* =============== FORMUL√ÅRIO =============== */
.form-card {
  background: var(--card-bg);
  padding: 40px;
  border-radius: 25px;
  box-shadow: var(--shadow-lg);
  margin-bottom: 30px;
}

.form-title {
  font-size: 2em;
  font-weight: 700;
  color: var(--text-color);
  margin-bottom: 30px;
  display: flex;
  align-items: center;
  gap: 15px;
}

.form-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  margin-bottom: 20px;
}

.form-group {
  display: flex;
  flex-direction: column;
}

.form-group label {
  font-size: 0.9em;
  font-weight: 600;
  color: var(--text-color);
  margin-bottom: 8px;
  display: flex;
  align-items: center;
  gap: 5px;
}

.required {
  color: var(--danger);
}

.form-group input,
.form-group select,
.form-group textarea {
  padding: 14px 18px;
  border: 2px solid var(--input-border);
  border-radius: 12px;
  font-size: 1em;
  font-family: 'Poppins', sans-serif;
  transition: all 0.3s;
  background: var(--input-bg);
  color: var(--text-color);
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
}

.form-group textarea {
  resize: vertical;
  min-height: 100px;
}

/* =============== BOT√ïES =============== */
.btn {
  padding: 16px 32px;
  border: none;
  border-radius: 12px;
  font-size: 1em;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  display: inline-flex;
  align-items: center;
  gap: 10px;
  justify-content: center;
  font-family: 'Poppins', sans-serif;
}

.btn-primary {
  background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
  color: white;
  box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 25px rgba(99, 102, 241, 0.5);
}

.btn-secondary {
  background: var(--gray);
  color: white;
}

.btn-success {
  background: var(--success);
  color: white;
}

.btn-danger {
  background: var(--danger);
  color: white;
}

.btn-info {
  background: var(--info);
  color: white;
}

.btn-warning {
  background: var(--warning);
  color: white;
}

.btn-sm {
  padding: 8px 16px;
  font-size: 0.85em;
}

.btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none !important;
}

/* =============== TABELA =============== */
.table-card {
  background: var(--card-bg);
  padding: 30px;
  border-radius: 25px;
  box-shadow: var(--shadow-lg);
  overflow: hidden;
}

.table-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 25px;
  flex-wrap: wrap;
  gap: 15px;
}

.table-title {
  font-size: 1.8em;
  font-weight: 700;
  color: var(--text-color);
}

.search-box {
  position: relative;
  width: 300px;
}

.search-box input {
  width: 100%;
  padding: 12px 20px 12px 45px;
  border: 2px solid var(--input-border);
  border-radius: 12px;
  font-size: 0.95em;
  font-family: 'Poppins', sans-serif;
  transition: all 0.3s;
  background: var(--input-bg);
  color: var(--text-color);
}

.search-icon {
  position: absolute;
  left: 15px;
  top: 50%;
  transform: translateY(-50%);
  color: var(--gray);
}

.table-wrapper {
  overflow-x: auto;
}

table {
  width: 100%;
  border-collapse: collapse;
}

thead {
  background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
  color: white;
}

thead th {
  padding: 15px;
  text-align: left;
  font-weight: 600;
  font-size: 0.9em;
  white-space: nowrap;
}

tbody tr {
  border-bottom: 1px solid var(--input-border);
  transition: all 0.3s;
}

tbody tr:hover {
  background: var(--input-bg);
}

tbody td {
  padding: 15px;
  font-size: 0.9em;
  color: var(--text-color);
}

/* =============== CARDS =============== */
.cards-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 25px;
  margin-top: 20px;
}

.consulta-card {
  background: var(--card-bg);
  padding: 25px;
  border-radius: 20px;
  box-shadow: var(--shadow);
  transition: all 0.3s;
  cursor: pointer;
  position: relative;
  overflow: hidden;
  border-left: 5px solid var(--primary);
}

.consulta-card:hover {
  transform: translateY(-5px);
  box-shadow: var(--shadow-lg);
}

.consulta-header {
  display: flex;
  justify-content: space-between;
  align-items: start;
  margin-bottom: 15px;
}

.consulta-tipo {
  font-size: 1.5em;
  margin-bottom: 5px;
}

.consulta-titulo {
  font-size: 1.2em;
  font-weight: 700;
  color: var(--text-color);
  margin-bottom: 10px;
}

.consulta-info {
  font-size: 0.95em;
  color: var(--text-secondary);
  margin: 8px 0;
  display: flex;
  align-items: center;
  gap: 8px;
}

.consulta-footer {
  margin-top: 20px;
  padding-top: 15px;
  border-top: 1px solid var(--input-border);
  display: flex;
  justify-content: space-between;
  align-items: center;
}

/* =============== MODAL =============== */
.modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.7);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 9999;
  backdrop-filter: blur(5px);
}

.modal.active {
  display: flex;
}

.modal-content {
  background: var(--card-bg);
  padding: 40px;
  border-radius: 25px;
  max-width: 800px;
  width: 90%;
  max-height: 90vh;
  overflow-y: auto;
  position: relative;
  animation: modalSlideIn 0.3s ease;
}

@keyframes modalSlideIn {
  from {
    opacity: 0;
    transform: translateY(-50px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.modal-close {
  position: absolute;
  top: 20px;
  right: 20px;
  font-size: 2em;
  color: var(--gray);
  cursor: pointer;
  transition: all 0.3s;
}

.modal-close:hover {
  color: var(--danger);
  transform: rotate(90deg);
}

.modal-title-section {
  text-align: center;
  margin-bottom: 30px;
}

.modal-title-section h2 {
  font-size: 2em;
  font-weight: 700;
  color: var(--text-color);
  margin-bottom: 10px;
}

/* =============== NOTIFICA√á√ÉO =============== */
.notification {
  position: fixed;
  top: 20px;
  right: 20px;
  background: var(--card-bg);
  padding: 20px 25px;
  border-radius: 15px;
  box-shadow: var(--shadow-lg);
  display: none;
  align-items: center;
  gap: 15px;
  z-index: 10001;
  min-width: 300px;
  animation: slideInRight 0.5s ease;
}

@keyframes slideInRight {
  from {
    opacity: 0;
    transform: translateX(100px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

.notification.show {
  display: flex;
}

.notification-icon {
  font-size: 2em;
}

.notification-content {
  flex: 1;
}

.notification-title {
  font-weight: 700;
  color: var(--text-color);
  margin-bottom: 5px;
}

.notification-message {
  font-size: 0.9em;
  color: var(--text-secondary);
}

.notification.success {
  border-left: 5px solid var(--success);
}

.notification.error {
  border-left: 5px solid var(--danger);
}

.notification.info {
  border-left: 5px solid var(--primary);
}

/* =============== LOADING OVERLAY =============== */
.loading-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.7);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 9998;
  backdrop-filter: blur(5px);
}

.loading-overlay.show {
  display: flex;
}

.loading-content {
  text-align: center;
  color: white;
}

.loading-spinner {
  width: 80px;
  height: 80px;
  border: 6px solid rgba(255,255,255,0.3);
  border-top-color: white;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 0 auto 20px;
}

/* =============== RESPONSIVO =============== */
@media (max-width: 768px) {
  .header h1 {
    font-size: 2.5em;
  }
  
  .nav-tabs {
    flex-direction: column;
  }
  
  .nav-tab {
    min-width: 100%;
  }
  
  .form-grid {
    grid-template-columns: 1fr;
  }
  
  .control-buttons {
    flex-direction: column;
  }
  
  .search-box {
    width: 100%;
  }
  
  .cards-grid {
    grid-template-columns: 1fr;
  }
}

@media print {
  .nav-tabs,
  .loading-screen,
  button,
  .btn,
  .control-buttons {
    display: none !important;
  }
  
  body {
    background: white !important;
  }
}
</style>
</head>

<body>

<!-- LOADING INICIAL -->
<div class="loading-screen">
  <div class="logo-animation">üè•</div>
  <div class="loading-text">CARREGANDO SISTEMA</div>
  <div class="spinner"></div>
</div>

<!-- LOADING OVERLAY -->
<div class="loading-overlay" id="loadingOverlay">
  <div class="loading-content">
    <div class="loading-spinner"></div>
    <p>Processando...</p>
  </div>
</div>

<!-- NOTIFICA√á√ÉO -->
<div class="notification" id="notification">
  <div class="notification-icon">‚úì</div>
  <div class="notification-content">
    <div class="notification-title">Sucesso</div>
    <div class="notification-message">Opera√ß√£o conclu√≠da</div>
  </div>
  <div class="notification-close" onclick="fecharNotificacao()" style="cursor: pointer; margin-left: 10px;">√ó</div>
</div>

<!-- BOT√ïES DE CONTROLE -->
<div class="control-buttons">
  <button class="btn-control" onclick="toggleDarkMode()" title="Modo Escuro/Claro">
    <span id="iconMode">üåô</span>
  </button>
</div>

<!-- CONTAINER PRINCIPAL -->
<div class="container">
  
  <!-- HEADER -->
  <div class="header">
    <h1>üè• Sistema Familiar Completo</h1>
    <p>Gerencie sua fam√≠lia e sa√∫de de forma integrada</p>
  </div>
  
  <!-- ESTAT√çSTICAS -->
  <div class="stats-bar">
    <div class="stat-card">
      <div class="stat-icon">üë•</div>
      <div class="stat-number" id="statTotal">0</div>
      <div class="stat-label">Total de Familiares</div>
    </div>
    
    <div class="stat-card">
      <div class="stat-icon">üè•</div>
      <div class="stat-number" id="statConsultas">0</div>
      <div class="stat-label">Consultas Agendadas</div>
    </div>
    
    <div class="stat-card">
      <div class="stat-icon">üìä</div>
      <div class="stat-number" id="statIdadeMedia">0</div>
      <div class="stat-label">Idade M√©dia</div>
    </div>
    
    <div class="stat-card">
      <div class="stat-icon">üéÇ</div>
      <div class="stat-number" id="statAniversarios">0</div>
      <div class="stat-label">Anivers√°rios Pr√≥ximos</div>
    </div>
  </div>
  
  <!-- NAVEGA√á√ÉO -->
  <div class="nav-tabs">
    <button class="nav-tab active" onclick="mudarAba('cadastro')">
      ‚úèÔ∏è Cadastro Familiar
    </button>
    <button class="nav-tab" onclick="mudarAba('lista')">
      üìã Lista Familiares
    </button>
    <button class="nav-tab" onclick="mudarAba('consultas')">
      üè• Consultas/Exames
    </button>
    <button class="nav-tab" onclick="mudarAba('lista-consultas')">
      üìù Ver Agendamentos
    </button>
    <button class="nav-tab" onclick="mudarAba('aniversarios')">
      üéÇ Anivers√°rios
    </button>
  </div>
  
  <!-- ABA CADASTRO FAMILIAR -->
  <div id="cadastro" class="content-section active">
    <div class="form-card">
      <div class="form-title">
        <span>üë§</span>
        <span id="formTitleText">Cadastrar Novo Familiar</span>
      </div>
      
      <form id="familyForm" onsubmit="salvarFamiliar(event)">
        <input type="hidden" id="editId">
        
        <div class="form-grid">
          <div class="form-group">
            <label>Nome Completo <span class="required">*</span></label>
            <input type="text" id="nome" required>
          </div>
          
          <div class="form-group">
            <label>Parentesco <span class="required">*</span></label>
            <select id="parentesco" required>
              <option value="">Selecione</option>
              <option value="Pai">Pai</option>
              <option value="M√£e">M√£e</option>
              <option value="Filho(a)">Filho(a)</option>
              <option value="Irm√£o(√£)">Irm√£o(√£)</option>
              <option value="Av√¥(√≥)">Av√¥(√≥)</option>
              <option value="Tio(a)">Tio(a)</option>
              <option value="Primo(a)">Primo(a)</option>
              <option value="C√¥njuge">C√¥njuge</option>
              <option value="Outro">Outro</option>
            </select>
          </div>
          
          <div class="form-group">
            <label>CPF</label>
            <input type="text" id="cpf" maxlength="14" placeholder="000.000.000-00">
          </div>
          
          <div class="form-group">
            <label>Data de Nascimento</label>
            <input type="date" id="nascimento">
          </div>
          
          <div class="form-group">
            <label>Cart√£o SUS</label>
            <input type="text" id="cartaoSus" maxlength="18">
          </div>
          
          <div class="form-group">
            <label>Telefone</label>
            <input type="tel" id="telefone" placeholder="(00) 00000-0000">
          </div>
          
          <div class="form-group">
            <label>Email</label>
            <input type="email" id="email">
          </div>
          
          <div class="form-group">
            <label>Profiss√£o</label>
            <input type="text" id="profissao">
          </div>
          
          <div class="form-group">
            <label>Estado Civil</label>
            <select id="estadoCivil">
              <option value="">Selecione</option>
              <option value="Solteiro(a)">Solteiro(a)</option>
              <option value="Casado(a)">Casado(a)</option>
              <option value="Divorciado(a)">Divorciado(a)</option>
              <option value="Vi√∫vo(a)">Vi√∫vo(a)</option>
              <option value="Uni√£o Est√°vel">Uni√£o Est√°vel</option>
            </select>
          </div>
          
          <div class="form-group">
            <label>Escolaridade</label>
            <select id="escolaridade">
              <option value="">Selecione</option>
              <option value="Fundamental Incompleto">Fundamental Incompleto</option>
              <option value="Fundamental Completo">Fundamental Completo</option>
              <option value="M√©dio Incompleto">M√©dio Incompleto</option>
              <option value="M√©dio Completo">M√©dio Completo</option>
              <option value="Superior Incompleto">Superior Incompleto</option>
              <option value="Superior Completo">Superior Completo</option>
              <option value="P√≥s-gradua√ß√£o">P√≥s-gradua√ß√£o</option>
            </select>
          </div>
          
          <div class="form-group">
            <label>Tipo Sangu√≠neo</label>
            <select id="tipoSanguineo">
              <option value="">Selecione</option>
              <option value="A+">A+</option>
              <option value="A-">A-</option>
              <option value="B+">B+</option>
              <option value="B-">B-</option>
              <option value="AB+">AB+</option>
              <option value="AB-">AB-</option>
              <option value="O+">O+</option>
              <option value="O-">O-</option>
            </select>
          </div>
          
          <div class="form-group">
            <label>Nacionalidade</label>
            <input type="text" id="nacionalidade" value="Brasileira">
          </div>
        </div>
        
        <div class="form-group">
          <label>Endere√ßo Completo</label>
          <input type="text" id="endereco">
        </div>
        
        <div class="form-group">
          <label>Observa√ß√µes</label>
          <textarea id="observacoes"></textarea>
        </div>
        
        <div style="display: flex; gap: 15px; margin-top: 30px;">
          <button type="submit" class="btn btn-primary" style="flex: 1;">
            <span id="btnSubmitText">üíæ Cadastrar Familiar</span>
          </button>
          <button type="button" class="btn btn-secondary" id="btnCancelar" onclick="cancelarEdicaoFamiliar()" style="display: none;">
            ‚ùå Cancelar
          </button>
        </div>
      </form>
    </div>
  </div>
  
  <!-- ABA LISTA FAMILIARES -->
  <div id="lista" class="content-section">
    <div class="table-card">
      <div class="table-header">
        <div class="table-title">üìã Lista de Familiares</div>
        <div class="search-box">
          <span class="search-icon">üîç</span>
          <input type="text" id="searchInputFamiliares" placeholder="Pesquisar..." onkeyup="pesquisarTabela('tableFamiliares', 'searchInputFamiliares')">
        </div>
      </div>
      
      <div class="table-wrapper">
        <table id="tableFamiliares">
          <thead>
            <tr>
              <th>Nome</th>
              <th>Parentesco</th>
              <th>Nascimento</th>
              <th>Idade</th>
              <th>Telefone</th>
              <th>A√ß√µes</th>
            </tr>
          </thead>
          <tbody id="tableFamiliaresBody">
            <tr>
              <td colspan="6" style="text-align: center; padding: 40px;">
                Nenhum familiar cadastrado
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
  
  <!-- ABA CADASTRO CONSULTAS/EXAMES -->
  <div id="consultas" class="content-section">
    <div class="form-card">
      <div class="form-title">
        <span>üè•</span>
        <span id="formConsultaTitleText">Agendar Consulta/Exame</span>
      </div>
      
      <form id="consultaForm" onsubmit="salvarConsulta(event)">
        <input type="hidden" id="consultaEditId">
        
        <div class="form-grid">
          <div class="form-group">
            <label>Tipo <span class="required">*</span></label>
            <select id="consultaTipo" required>
              <option value="">Selecione</option>
              <option value="Consulta">Consulta</option>
              <option value="Exame">Exame</option>
            </select>
          </div>
          
          <div class="form-group">
            <label>Familiar <span class="required">*</span></label>
            <select id="consultaFamiliar" required>
              <option value="">Selecione</option>
            </select>
          </div>
          
          <div class="form-group">
            <label>Data <span class="required">*</span></label>
            <input type="date" id="consultaData" required>
          </div>
          
          <div class="form-group">
            <label>Hora <span class="required">*</span></label>
            <input type="time" id="consultaHora" required>
          </div>
          
          <div class="form-group">
            <label>M√©dico/Profissional</label>
            <input type="text" id="consultaMedico">
          </div>
          
          <div class="form-group">
            <label>Especialidade</label>
            <input type="text" id="consultaEspecialidade" placeholder="Ex: Cardiologia, Raio-X">
          </div>
          
          <div class="form-group">
            <label>Local <span class="required">*</span></label>
            <input type="text" id="consultaLocal" required placeholder="Cl√≠nica/Hospital">
          </div>
          
          <div class="form-group">
            <label>Telefone do Local</label>
            <input type="tel" id="consultaTelefone" placeholder="(00) 0000-0000">
          </div>
          
          <div class="form-group">
            <label>Status <span class="required">*</span></label>
            <select id="consultaStatus" required>
              <option value="Agendado">üìÖ Agendado</option>
              <option value="Aguardando">‚è≥ Aguardando</option>
              <option value="Realizado">‚úÖ Realizado</option>
              <option value="Cancelado">‚ùå Cancelado</option>
            </select>
          </div>
        </div>
        
        <div class="form-group">
          <label>Observa√ß√µes</label>
          <textarea id="consultaObservacoes" placeholder="Instru√ß√µes, preparos, documentos necess√°rios..."></textarea>
        </div>
        
        <div style="display: flex; gap: 15px; margin-top: 30px;">
          <button type="submit" class="btn btn-primary" style="flex: 1;">
            <span id="btnConsultaSubmitText">üóìÔ∏è Agendar</span>
          </button>
          <button type="button" class="btn btn-secondary" id="btnConsultaCancelar" onclick="cancelarEdicaoConsulta()" style="display: none;">
            ‚ùå Cancelar
          </button>
        </div>
      </form>
    </div>
  </div>
  
  <!-- ABA LISTA CONSULTAS -->
  <div id="lista-consultas" class="content-section">
    <div class="table-card">
      <div class="table-header">
        <div class="table-title">üìù Agendamentos</div>
        <div class="search-box">
          <span class="search-icon">üîç</span>
          <input type="text" id="searchInputConsultas" placeholder="Pesquisar..." onkeyup="pesquisarTabela('tableConsultas', 'searchInputConsultas')">
        </div>
      </div>
      
      <div style="margin-bottom: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
        <button class="btn btn-info btn-sm" onclick="filtrarPorStatus('Agendado')">üìÖ Agendados</button>
        <button class="btn btn-warning btn-sm" onclick="filtrarPorStatus('Aguardando')">‚è≥ Aguardando</button>
        <button class="btn btn-success btn-sm" onclick="filtrarPorStatus('Realizado')">‚úÖ Realizados</button>
        <button class="btn btn-danger btn-sm" onclick="filtrarPorStatus('Cancelado')">‚ùå Cancelados</button>
        <button class="btn btn-secondary btn-sm" onclick="filtrarPorStatus('')">üîÑ Todos</button>
      </div>
      
      <div class="table-wrapper">
        <table id="tableConsultas">
          <thead>
            <tr>
              <th>Tipo</th>
              <th>Familiar</th>
              <th>Data</th>
              <th>Hora</th>
              <th>Local</th>
              <th>Status</th>
              <th>A√ß√µes</th>
            </tr>
          </thead>
          <tbody id="tableConsultasBody">
            <tr>
              <td colspan="7" style="text-align: center; padding: 40px;">
                Nenhuma consulta/exame agendado
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    
    <!-- CARDS DE CONSULTAS -->
    <div style="margin-top: 40px;">
      <h3 style="color: var(--text-color); margin-bottom: 20px;">üìã Pr√≥ximos Agendamentos</h3>
      <div class="cards-grid" id="consultasCardsGrid"></div>
    </div>
  </div>
  
  <!-- ABA ANIVERS√ÅRIOS -->
  <div id="aniversarios" class="content-section">
    <div class="table-card">
      <div class="table-header">
        <div class="table-title">üéÇ Anivers√°rios Pr√≥ximos</div>
      </div>
      <div id="aniversariosList"></div>
    </div>
  </div>
  
</div>

<!-- MODAL DETALHES CONSULTA -->
<div class="modal" id="modalConsulta" onclick="fecharModalConsulta()">
  <div class="modal-content" onclick="event.stopPropagation()">
    <span class="modal-close" onclick="fecharModalConsulta()">√ó</span>
    
    <div class="modal-title-section">
      <h2 id="modalConsultaTitulo">Detalhes do Agendamento</h2>
    </div>
    
    <div id="modalConsultaBody"></div>
    
    <div style="display: flex; gap: 15px; justify-content: center; margin-top: 30px;">
      <button class="btn btn-primary" onclick="editarConsultaDoModal()">‚úèÔ∏è Editar</button>
      <button class="btn btn-danger" onclick="deletarConsultaDoModal()">üóëÔ∏è Excluir</button>
    </div>
  </div>
</div>

<script>
// =============== CONFIGURA√á√ÉO ===============
const API_URL = 'https://script.google.com/macros/s/AKfycbw644qM0q5F7Tylt-4kpNoamaSzYINt-bH_h744ydI6x3niS7Y3nR_rEjmabDimQa34hA/exec';

let familiares = [];
let consultas = [];
let consultaAtual = null;

// =============== MODO ESCURO ===============
function toggleDarkMode() {
  document.body.classList.toggle('dark-mode');
  const isDark = document.body.classList.contains('dark-mode');
  localStorage.setItem('darkMode', isDark);
  document.getElementById('iconMode').textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
}

window.addEventListener('load', () => {
  if (localStorage.getItem('darkMode') === 'true') {
    document.body.classList.add('dark-mode');
    document.getElementById('iconMode').textContent = '‚òÄÔ∏è';
  }
});

// =============== M√ÅSCARAS ===============
document.getElementById('cpf')?.addEventListener('input', function(e) {
  let valor = e.target.value.replace(/\D/g, '');
  valor = valor.replace(/(\d{3})(\d)/, '$1.$2');
  valor = valor.replace(/(\d{3})(\d)/, '$1.$2');
  valor = valor.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
  e.target.value = valor;
});

document.getElementById('telefone')?.addEventListener('input', function(e) {
  let valor = e.target.value.replace(/\D/g, '');
  if (valor.length <= 10) {
    valor = valor.replace(/(\d{2})(\d)/, '($1) $2');
    valor = valor.replace(/(\d{4})(\d)/, '$1-$2');
  } else {
    valor = valor.replace(/(\d{2})(\d)/, '($1) $2');
    valor = valor.replace(/(\d{5})(\d)/, '$1-$2');
  }
  e.target.value = valor;
});

// =============== NAVEGA√á√ÉO ===============
function mudarAba(aba) {
  document.querySelectorAll('.content-section').forEach(section => {
    section.classList.remove('active');
  });
  document.querySelectorAll('.nav-tab').forEach(tab => {
    tab.classList.remove('active');
  });
  document.getElementById(aba).classList.add('active');
  event.target.classList.add('active');
  
  if (aba === 'lista') carregarTabelaFamiliares();
  if (aba === 'consultas') atualizarSelectFamiliares();
  if (aba === 'lista-consultas') {
    carregarTabelaConsultas();
    carregarCardsConsultas();
  }
  if (aba === 'aniversarios') carregarAniversarios();
}

// =============== NOTIFICA√á√ÉO ===============
function mostrarNotificacao(mensagem, tipo = 'success', duracao = 5000) {
  const notif = document.getElementById('notification');
  const icon = notif.querySelector('.notification-icon');
  const title = notif.querySelector('.notification-title');
  const message = notif.querySelector('.notification-message');
  
  notif.className = 'notification show ' + tipo;
  
  if (tipo === 'success') {
    icon.textContent = '‚úì';
    title.textContent = 'Sucesso';
  } else if (tipo === 'error') {
    icon.textContent = '‚úó';
    title.textContent = 'Erro';
  } else if (tipo === 'info') {
    icon.textContent = '‚Ñπ';
    title.textContent = 'Informa√ß√£o';
  }
  
  message.textContent = mensagem;
  setTimeout(() => notif.classList.remove('show'), duracao);
}

function fecharNotificacao() {
  document.getElementById('notification').classList.remove('show');
}

// =============== CARREGAR DADOS ===============
async function carregar() {
  try {
    const res = await fetch(API_URL + '?acao=listar');
    const dados = await res.json();
    
    if (dados && dados.length > 1) {
      familiares = [];
      
      for (let i = 1; i < dados.length; i++) {
        const linha = dados[i];
        familiares.push({
          id: linha[0],
          nome: linha[1],
          parentesco: linha[2],
          cpf: linha[3],
          nascimento: linha[4],
          idade: linha[5],
          cartaoSus: linha[6],
          telefone: linha[7],
          email: linha[8],
          profissao: linha[9],
          estadoCivil: linha[10],
          escolaridade: linha[11],
          tipoSanguineo: linha[12],
          nacionalidade: linha[13],
          endereco: linha[14],
          observacoes: linha[15],
          dataCadastro: linha[16],
          ultimaAtualizacao: linha[17],
          status: linha[18]
        });
      }
    }
  } catch (erro) {
    console.error('Erro ao carregar familiares:', erro);
  }
}

async function carregarConsultas() {
  try {
    const res = await fetch(API_URL + '?acao=consultas');
    const dados = await res.json();
    
    if (dados && dados.length > 1) {
      consultas = [];
      
      for (let i = 1; i < dados.length; i++) {
        const linha = dados[i];
        consultas.push({
          id: linha[0],
          idFamiliar: linha[1],
          nomeFamiliar: linha[2],
          dataConsulta: linha[3],
          hora: linha[4],
          medico: linha[5],
          especialidade: linha[6],
          local: linha[7],
          telefoneLocal: linha[8],
          observacoes: linha[9],
          status: linha[10],
          tipo: linha[11],
          dataCadastro: linha[12]
        });
      }
    }
  } catch (erro) {
    console.error('Erro ao carregar consultas:', erro);
  }
}

// =============== CARREGAR ESTAT√çSTICAS ===============
async function carregarEstatisticas() {
  try {
    const res = await fetch(API_URL + '?acao=estatisticas');
    const stats = await res.json();
    
    document.getElementById('statTotal').textContent = stats.total || 0;
    document.getElementById('statIdadeMedia').textContent = stats.idadeMedia || 0;
    
    const resAniv = await fetch(API_URL + '?acao=aniversarios');
    const aniv = await resAniv.json();
    document.getElementById('statAniversarios').textContent = aniv.length || 0;
    
    await carregarConsultas();
    const agendadas = consultas.filter(c => c.status === 'Agendado' || c.status === 'Aguardando').length;
    document.getElementById('statConsultas').textContent = agendadas;
    
  } catch (erro) {
    console.error('Erro ao carregar estat√≠sticas:', erro);
  }
}

// =============== SALVAR FAMILIAR ===============
async function salvarFamiliar(e) {
  e.preventDefault();
  
  const editId = document.getElementById('editId').value;
  
  const dados = {
    acao: editId ? 'atualizar' : 'cadastrar',
    id: editId || undefined,
    nome: document.getElementById('nome').value,
    parentesco: document.getElementById('parentesco').value,
    cpf: document.getElementById('cpf').value,
    nascimento: document.getElementById('nascimento').value,
    cartaoSus: document.getElementById('cartaoSus').value,
    telefone: document.getElementById('telefone').value,
    email: document.getElementById('email').value,
    profissao: document.getElementById('profissao').value,
    estadoCivil: document.getElementById('estadoCivil').value,
    escolaridade: document.getElementById('escolaridade').value,
    tipoSanguineo: document.getElementById('tipoSanguineo').value,
    nacionalidade: document.getElementById('nacionalidade').value,
    endereco: document.getElementById('endereco').value,
    observacoes: document.getElementById('observacoes').value
  };
  
  const overlay = document.getElementById('loadingOverlay');
  overlay.classList.add('show');
  
  try {
    await fetch(API_URL, {
      method: 'POST',
      mode: 'no-cors',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify(dados)
    });
    
    mostrarNotificacao(editId ? 'Familiar atualizado!' : 'Familiar cadastrado!', 'success');
    
    document.getElementById('familyForm').reset();
    cancelarEdicaoFamiliar();
    
    setTimeout(async () => {
      await carregar();
      await carregarEstatisticas();
      overlay.classList.remove('show');
    }, 1500);
    
  } catch (erro) {
    overlay.classList.remove('show');
    mostrarNotificacao('Solicita√ß√£o enviada! Aguarde sincroniza√ß√£o.', 'info');
    setTimeout(async () => {
      await carregar();
      await carregarEstatisticas();
    }, 2000);
  }
}

function cancelarEdicaoFamiliar() {
  document.getElementById('editId').value = '';
  document.getElementById('formTitleText').textContent = 'Cadastrar Novo Familiar';
  document.getElementById('btnSubmitText').textContent = 'üíæ Cadastrar Familiar';
  document.getElementById('btnCancelar').style.display = 'none';
}

// =============== TABELA FAMILIARES ===============
function carregarTabelaFamiliares() {
  const tbody = document.getElementById('tableFamiliaresBody');
  if (!tbody) return;
  
  tbody.innerHTML = '';
  
  if (familiares.length === 0) {
    tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 40px;">Nenhum familiar cadastrado</td></tr>';
    return;
  }
  
  familiares.forEach(f => {
    const tr = document.createElement('tr');
    
    tr.innerHTML = `
      <td><strong>${f.nome}</strong></td>
      <td>${f.parentesco}</td>
      <td>${formatarData(f.nascimento) || '-'}</td>
      <td>${f.idade || '-'}</td>
      <td>${f.telefone || '-'}</td>
      <td>
        <button class="btn btn-success btn-sm" onclick="editarFamiliar(${f.id})">‚úèÔ∏è</button>
        <button class="btn btn-danger btn-sm" onclick="deletarFamiliar(${f.id})">üóëÔ∏è</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

function editarFamiliar(id) {
  const familiar = familiares.find(f => f.id == id);
  if (!familiar) return;
  
  document.getElementById('editId').value = familiar.id;
  document.getElementById('nome').value = familiar.nome;
  document.getElementById('parentesco').value = familiar.parentesco;
  document.getElementById('cpf').value = familiar.cpf;
  document.getElementById('nascimento').value = familiar.nascimento;
  document.getElementById('cartaoSus').value = familiar.cartaoSus;
  document.getElementById('telefone').value = familiar.telefone;
  document.getElementById('email').value = familiar.email;
  document.getElementById('profissao').value = familiar.profissao;
  document.getElementById('estadoCivil').value = familiar.estadoCivil;
  document.getElementById('escolaridade').value = familiar.escolaridade;
  document.getElementById('tipoSanguineo').value = familiar.tipoSanguineo;
  document.getElementById('nacionalidade').value = familiar.nacionalidade;
  document.getElementById('endereco').value = familiar.endereco;
  document.getElementById('observacoes').value = familiar.observacoes;
  
  document.getElementById('formTitleText').textContent = 'Editar Familiar';
  document.getElementById('btnSubmitText').textContent = 'üíæ Atualizar Familiar';
  document.getElementById('btnCancelar').style.display = 'block';
  
  mudarAba('cadastro');
}

async function deletarFamiliar(id) {
  if (!confirm('Tem certeza que deseja excluir?')) return;
  
  try {
    await fetch(API_URL, {
      method: 'POST',
      mode: 'no-cors',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ acao: 'deletar', id: id })
    });
    
    mostrarNotificacao('Familiar exclu√≠do!', 'success');
    
    setTimeout(async () => {
      await carregar();
      await carregarEstatisticas();
      carregarTabelaFamiliares();
    }, 1000);
    
  } catch (erro) {
    mostrarNotificacao('Solicita√ß√£o enviada!', 'info');
  }
}

// =============== CONSULTAS/EXAMES ===============
function atualizarSelectFamiliares() {
  const select = document.getElementById('consultaFamiliar');
  if (!select) return;
  
  select.innerHTML = '<option value="">Selecione</option>';
  
  familiares.forEach(f => {
    const option = document.createElement('option');
    option.value = f.id;
    option.textContent = f.nome;
    option.dataset.nome = f.nome;
    select.appendChild(option);
  });
}

async function salvarConsulta(e) {
  e.preventDefault();
  
  const editId = document.getElementById('consultaEditId').value;
  const selectFamiliar = document.getElementById('consultaFamiliar');
  const nomeFamiliar = selectFamiliar.selectedOptions[0]?.dataset.nome || '';
  
  const dados = {
    acao: editId ? 'atualizarConsulta' : 'cadastrarConsulta',
    id: editId || undefined,
    tipo: document.getElementById('consultaTipo').value,
    idFamiliar: selectFamiliar.value,
    nomeFamiliar: nomeFamiliar,
    dataConsulta: document.getElementById('consultaData').value,
    hora: document.getElementById('consultaHora').value,
    medico: document.getElementById('consultaMedico').value,
    especialidade: document.getElementById('consultaEspecialidade').value,
    local: document.getElementById('consultaLocal').value,
    telefoneLocal: document.getElementById('consultaTelefone').value,
    status: document.getElementById('consultaStatus').value,
    observacoes: document.getElementById('consultaObservacoes').value
  };
  
  const overlay = document.getElementById('loadingOverlay');
  overlay.classList.add('show');
  
  try {
    await fetch(API_URL, {
      method: 'POST',
      mode: 'no-cors',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify(dados)
    });
    
    mostrarNotificacao(editId ? 'Agendamento atualizado!' : 'Agendamento criado!', 'success');
    
    document.getElementById('consultaForm').reset();
    cancelarEdicaoConsulta();
    
    setTimeout(async () => {
      await carregarConsultas();
      await carregarEstatisticas();
      overlay.classList.remove('show');
    }, 1500);
    
  } catch (erro) {
    overlay.classList.remove('show');
    mostrarNotificacao('Solicita√ß√£o enviada! Aguarde sincroniza√ß√£o.', 'info');
    setTimeout(async () => {
      await carregarConsultas();
      await carregarEstatisticas();
    }, 2000);
  }
}

function cancelarEdicaoConsulta() {
  document.getElementById('consultaEditId').value = '';
  document.getElementById('formConsultaTitleText').textContent = 'Agendar Consulta/Exame';
  document.getElementById('btnConsultaSubmitText').textContent = 'üóìÔ∏è Agendar';
  document.getElementById('btnConsultaCancelar').style.display = 'none';
}

// =============== TABELA CONSULTAS ===============
function carregarTabelaConsultas() {
  const tbody = document.getElementById('tableConsultasBody');
  if (!tbody) return;
  
  tbody.innerHTML = '';
  
  if (consultas.length === 0) {
    tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 40px;">Nenhuma consulta/exame agendado</td></tr>';
    return;
  }
  
  consultas.sort((a, b) => new Date(a.dataConsulta) - new Date(b.dataConsulta));
  
  consultas.forEach(c => {
    const tr = document.createElement('tr');
    
    tr.innerHTML = `
      <td>${c.tipo || 'Consulta'}</td>
      <td><strong>${c.nomeFamiliar}</strong></td>
      <td>${formatarData(c.dataConsulta)}</td>
      <td>${c.hora}</td>
      <td>${c.local}</td>
      <td><span class="status-badge status-${c.status.toLowerCase()}">${c.status}</span></td>
      <td>
        <button class="btn btn-info btn-sm" onclick="visualizarConsulta(${c.id})">üëÅÔ∏è</button>
        <button class="btn btn-success btn-sm" onclick="editarConsulta(${c.id})">‚úèÔ∏è</button>
        <button class="btn btn-danger btn-sm" onclick="deletarConsulta(${c.id})">üóëÔ∏è</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

// =============== CARDS CONSULTAS ===============
function carregarCardsConsultas() {
  const grid = document.getElementById('consultasCardsGrid');
  if (!grid) return;
  
  grid.innerHTML = '';
  
  const proximas = consultas.filter(c => 
    c.status === 'Agendado' || c.status === 'Aguardando'
  ).sort((a, b) => new Date(a.dataConsulta) - new Date(b.dataConsulta));
  
  if (proximas.length === 0) {
    grid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 40px;"><h3>Nenhum agendamento pr√≥ximo</h3></div>';
    return;
  }
  
  proximas.forEach(c => {
    const card = document.createElement('div');
    card.className = 'consulta-card';
    card.onclick = () => visualizarConsulta(c.id);
    
    const diasRestantes = Math.ceil((new Date(c.dataConsulta) - new Date()) / (1000 * 60 * 60 * 24));
    
    card.innerHTML = `
      <div class="consulta-header">
        <div>
          <div class="consulta-tipo">${c.tipo === 'Exame' ? 'üî¨' : 'üè•'}</div>
          <div class="consulta-titulo">${c.tipo || 'Consulta'}</div>
        </div>
        <span class="status-badge status-${c.status.toLowerCase()}">${c.status}</span>
      </div>
      <div class="consulta-info">üë§ ${c.nomeFamiliar}</div>
      <div class="consulta-info">üìÖ ${formatarData(c.dataConsulta)}</div>
      <div class="consulta-info">‚è∞ ${c.hora}</div>
      <div class="consulta-info">üìç ${c.local}</div>
      ${c.medico ? `<div class="consulta-info">üë®‚Äç‚öïÔ∏è ${c.medico}</div>` : ''}
      <div class="consulta-footer">
        <small style="color: var(--text-secondary);">${diasRestantes >= 0 ? `Em ${diasRestantes} ${diasRestantes === 1 ? 'dia' : 'dias'}` : 'Atrasado'}</small>
      </div>
    `;
    
    grid.appendChild(card);
  });
}

// =============== VISUALIZAR CONSULTA ===============
function visualizarConsulta(id) {
  const consulta = consultas.find(c => c.id == id);
  if (!consulta) return;
  
  consultaAtual = consulta;
  
  document.getElementById('modalConsultaTitulo').textContent = `${consulta.tipo || 'Consulta'} - ${consulta.nomeFamiliar}`;
  
  const modalBody = document.getElementById('modalConsultaBody');
  modalBody.innerHTML = `
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
      <div style="padding: 15px; background: var(--input-bg); border-radius: 12px;">
        <div style="font-size: 0.85em; color: var(--text-secondary); font-weight: 600; margin-bottom: 5px;">TIPO</div>
        <div style="font-size: 1.05em; color: var(--text-color); font-weight: 500;">${consulta.tipo || 'Consulta'}</div>
      </div>
      <div style="padding: 15px; background: var(--input-bg); border-radius: 12px;">
        <div style="font-size: 0.85em; color: var(--text-secondary); font-weight: 600; margin-bottom: 5px;">DATA</div>
        <div style="font-size: 1.05em; color: var(--text-color); font-weight: 500;">${formatarData(consulta.dataConsulta)}</div>
      </div>
      <div style="padding: 15px; background: var(--input-bg); border-radius: 12px;">
        <div style="font-size: 0.85em; color: var(--text-secondary); font-weight: 600; margin-bottom: 5px;">HORA</div>
        <div style="font-size: 1.05em; color: var(--text-color); font-weight: 500;">${consulta.hora}</div>
      </div>
      <div style="padding: 15px; background: var(--input-bg); border-radius: 12px;">
        <div style="font-size: 0.85em; color: var(--text-secondary); font-weight: 600; margin-bottom: 5px;">STATUS</div>
        <div><span class="status-badge status-${consulta.status.toLowerCase()}">${consulta.status}</span></div>
      </div>
      <div style="padding: 15px; background: var(--input-bg); border-radius: 12px; grid-column: 1/-1;">
        <div style="font-size: 0.85em; color: var(--text-secondary); font-weight: 600; margin-bottom: 5px;">LOCAL</div>
        <div style="font-size: 1.05em; color: var(--text-color); font-weight: 500;">${consulta.local}</div>
      </div>
      ${consulta.medico ? `
      <div style="padding: 15px; background: var(--input-bg); border-radius: 12px;">
        <div style="font-size: 0.85em; color: var(--text-secondary); font-weight: 600; margin-bottom: 5px;">M√âDICO</div>
        <div style="font-size: 1.05em; color: var(--text-color); font-weight: 500;">${consulta.medico}</div>
      </div>
      ` : ''}
      ${consulta.especialidade ? `
      <div style="padding: 15px; background: var(--input-bg); border-radius: 12px;">
        <div style="font-size: 0.85em; color: var(--text-secondary); font-weight: 600; margin-bottom: 5px;">ESPECIALIDADE</div>
        <div style="font-size: 1.05em; color: var(--text-color); font-weight: 500;">${consulta.especialidade}</div>
      </div>
      ` : ''}
      ${consulta.telefoneLocal ? `
      <div style="padding: 15px; background: var(--input-bg); border-radius: 12px;">
        <div style="font-size: 0.85em; color: var(--text-secondary); font-weight: 600; margin-bottom: 5px;">TELEFONE</div>
        <div style="font-size: 1.05em; color: var(--text-color); font-weight: 500;">${consulta.telefoneLocal}</div>
      </div>
      ` : ''}
      ${consulta.observacoes ? `
      <div style="padding: 15px; background: var(--input-bg); border-radius: 12px; grid-column: 1/-1;">
        <div style="font-size: 0.85em; color: var(--text-secondary); font-weight: 600; margin-bottom: 5px;">OBSERVA√á√ïES</div>
        <div style="font-size: 1.05em; color: var(--text-color); font-weight: 500;">${consulta.observacoes}</div>
      </div>
      ` : ''}
    </div>
  `;
  
  document.getElementById('modalConsulta').classList.add('active');
}

function fecharModalConsulta() {
  document.getElementById('modalConsulta').classList.remove('active');
  consultaAtual = null;
}

function editarConsultaDoModal() {
  if (consultaAtual) {
    editarConsulta(consultaAtual.id);
    fecharModalConsulta();
  }
}

function deletarConsultaDoModal() {
  if (consultaAtual) {
    deletarConsulta(consultaAtual.id);
    fecharModalConsulta();
  }
}

function editarConsulta(id) {
  const consulta = consultas.find(c => c.id == id);
  if (!consulta) return;
  
  document.getElementById('consultaEditId').value = consulta.id;
  document.getElementById('consultaTipo').value = consulta.tipo;
  document.getElementById('consultaFamiliar').value = consulta.idFamiliar;
  document.getElementById('consultaData').value = consulta.dataConsulta;
  document.getElementById('consultaHora').value = consulta.hora;
  document.getElementById('consultaMedico').value = consulta.medico;
  document.getElementById('consultaEspecialidade').value = consulta.especialidade;
  document.getElementById('consultaLocal').value = consulta.local;
  document.getElementById('consultaTelefone').value = consulta.telefoneLocal;
  document.getElementById('consultaStatus').value = consulta.status;
  document.getElementById('consultaObservacoes').value = consulta.observacoes;
  
  document.getElementById('formConsultaTitleText').textContent = 'Editar Agendamento';
  document.getElementById('btnConsultaSubmitText').textContent = 'üíæ Atualizar';
  document.getElementById('btnConsultaCancelar').style.display = 'block';
  
  mudarAba('consultas');
}

async function deletarConsulta(id) {
  if (!confirm('Tem certeza que deseja excluir este agendamento?')) return;
  
  try {
    await fetch(API_URL, {
      method: 'POST',
      mode: 'no-cors',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ acao: 'deletarConsulta', id: id })
    });
    
    mostrarNotificacao('Agendamento exclu√≠do!', 'success');
    
    setTimeout(async () => {
      await carregarConsultas();
      await carregarEstatisticas();
      carregarTabelaConsultas();
      carregarCardsConsultas();
    }, 1000);
    
  } catch (erro) {
    mostrarNotificacao('Solicita√ß√£o enviada!', 'info');
  }
}

// =============== FILTROS ===============
function filtrarPorStatus(status) {
  const linhas = document.querySelectorAll('#tableConsultasBody tr');
  
  linhas.forEach(linha => {
    const statusCell = linha.querySelector('.status-badge');
    if (!statusCell) return;
    
    if (status === '' || statusCell.textContent === status) {
      linha.style.display = '';
    } else {
      linha.style.display = 'none';
    }
  });
}

function pesquisarTabela(tabelaId, inputId) {
  const input = document.getElementById(inputId);
  const filter = input.value.toLowerCase();
  const table = document.getElementById(tabelaId);
  const tr = table.getElementsByTagName('tr');
  
  for (let i = 1; i < tr.length; i++) {
    const td = tr[i].getElementsByTagName('td');
    let found = false;
    
    for (let j = 0; j < td.length; j++) {
      if (td[j]) {
        const txtValue = td[j].textContent || td[j].innerText;
        if (txtValue.toLowerCase().indexOf(filter) > -1) {
          found = true;
          break;
        }
      }
    }
    
    tr[i].style.display = found ? '' : 'none';
  }
}

// =============== ANIVERS√ÅRIOS ===============
async function carregarAniversarios() {
  const lista = document.getElementById('aniversariosList');
  if (!lista) return;
  
  lista.innerHTML = '';
  
  try {
    const res = await fetch(API_URL + '?acao=aniversarios');
    const aniversarios = await res.json();
    
    if (aniversarios.length === 0) {
      lista.innerHTML = '<div style="text-align: center; padding: 40px;"><h3>üéâ Nenhum anivers√°rio pr√≥ximo</h3></div>';
      return;
    }
    
    aniversarios.forEach(a => {
      const div = document.createElement('div');
      div.className = 'consulta-card';
      div.style.borderLeft = '5px solid var(--secondary)';
      
      div.innerHTML = `
        <div class="consulta-header">
          <div>
            <div class="consulta-tipo">üéÇ</div>
            <div class="consulta-titulo">${a.nome}</div>
          </div>
        </div>
        <div class="consulta-info">üë§ ${a.parentesco}</div>
        <div class="consulta-info">üìÖ ${formatarData(a.dataNascimento)}</div>
        <div class="consulta-info">üéâ Far√° ${a.idadeQueFara} anos</div>
        <div class="consulta-footer">
          <small style="color: var(--text-secondary);">Em ${a.diasRestantes} ${a.diasRestantes === 1 ? 'dia' : 'dias'}</small>
        </div>
      `;
      
      lista.appendChild(div);
    });
    
  } catch (erro) {
    lista.innerHTML = '<div style="text-align: center; padding: 40px;"><p>Erro ao carregar</p></div>';
  }
}

// =============== UTILIDADES ===============
function formatarData(data) {
  if (!data) return '';
  const d = new Date(data + 'T00:00:00');
  return d.toLocaleDateString('pt-BR');
}

// =============== INICIALIZAR ===============
async function inicializar() {
  await carregar();
  await carregarConsultas();
  await carregarEstatisticas();
  carregarTabelaFamiliares();
  atualizarSelectFamiliares();
}

setTimeout(() => {
  inicializar();
}, 3500);
</script>

</body>
</html>
