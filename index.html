<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema Familiar - Vers√£o Final</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

:root {
  --primary: #6366f1;
  --primary-dark: #4f46e5;
  --secondary: #ec4899;
  --success: #10b981;
  --danger: #ef4444;
  --warning: #f59e0b;
  --dark: #1e293b;
  --light: #f8fafc;
  --gray: #64748b;
  --shadow: 0 10px 40px rgba(0,0,0,0.1);
  --shadow-lg: 0 20px 60px rgba(0,0,0,0.15);
  
  /* Tema Claro (padr√£o) */
  --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  --card-bg: #ffffff;
  --text-color: #1e293b;
  --text-secondary: #64748b;
  --input-bg: #f8fafc;
  --input-border: #e2e8f0;
}

body.dark-mode {
  --bg-gradient: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
  --card-bg: #1e293b;
  --text-color: #f1f5f9;
  --text-secondary: #94a3b8;
  --input-bg: #0f172a;
  --input-border: #334155;
}

body {
  font-family: 'Poppins', sans-serif;
  background: var(--bg-gradient);
  min-height: 100vh;
  padding: 20px;
  overflow-x: hidden;
  color: var(--text-color);
  transition: all 0.3s ease;
}

/* =============== TELA DE LOGIN =============== */
.login-screen {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: var(--bg-gradient);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 10001;
  transition: opacity 0.3s ease;
}

.login-screen.hidden {
  opacity: 0;
  pointer-events: none;
}

.login-box {
  background: var(--card-bg);
  padding: 50px;
  border-radius: 25px;
  box-shadow: var(--shadow-lg);
  max-width: 450px;
  width: 90%;
  text-align: center;
}

.login-logo {
  font-size: 4em;
  margin-bottom: 20px;
}

.login-title {
  font-family: 'Playfair Display', serif;
  font-size: 2.5em;
  font-weight: 900;
  color: var(--primary);
  margin-bottom: 10px;
}

.login-subtitle {
  color: var(--text-secondary);
  margin-bottom: 40px;
}

.login-form {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.login-input {
  padding: 16px 20px;
  border: 2px solid var(--input-border);
  border-radius: 12px;
  font-size: 1em;
  font-family: 'Poppins', sans-serif;
  background: var(--input-bg);
  color: var(--text-color);
  transition: all 0.3s;
}

.login-input:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
}

.login-error {
  background: #fef2f2;
  color: #ef4444;
  padding: 12px;
  border-radius: 8px;
  font-size: 0.9em;
  display: none;
}

.login-error.show {
  display: block;
}

/* =============== LOADING =============== */
.loading-screen {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: var(--bg-gradient);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  z-index: 10000;
  animation: fadeOut 1s ease 2.5s forwards;
}

@keyframes fadeOut {
  to {
    opacity: 0;
    visibility: hidden;
  }
}

.logo-animation {
  font-family: 'Playfair Display', serif;
  font-size: 4em;
  font-weight: 900;
  color: white;
  text-shadow: 0 5px 30px rgba(0,0,0,0.3);
  animation: logoFloat 1.5s ease-in-out infinite;
  margin-bottom: 30px;
}

@keyframes logoFloat {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

.loading-text {
  color: white;
  font-size: 1.2em;
  font-weight: 300;
  letter-spacing: 3px;
  animation: pulse 1.5s ease-in-out infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 0.4; }
  50% { opacity: 1; }
}

.spinner {
  width: 60px;
  height: 60px;
  border: 4px solid rgba(255,255,255,0.3);
  border-top-color: white;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin-top: 30px;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* =============== CONTAINER =============== */
.container {
  max-width: 1400px;
  margin: 0 auto;
  opacity: 0;
  animation: slideInUp 0.8s ease 3s forwards;
}

@keyframes slideInUp {
  from {
    opacity: 0;
    transform: translateY(50px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* =============== HEADER =============== */
.header {
  text-align: center;
  margin-bottom: 40px;
  position: relative;
}

.header h1 {
  font-family: 'Playfair Display', serif;
  font-size: 3.5em;
  font-weight: 900;
  color: white;
  text-shadow: 0 5px 30px rgba(0,0,0,0.2);
  margin-bottom: 10px;
  letter-spacing: -1px;
}

.header p {
  color: rgba(255,255,255,0.9);
  font-size: 1.1em;
  font-weight: 300;
}

/* =============== BOT√ïES DE CONTROLE =============== */
.control-buttons {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 1000;
  display: flex;
  gap: 10px;
}

.btn-control {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  border: none;
  background: var(--card-bg);
  color: var(--text-color);
  font-size: 1.3em;
  cursor: pointer;
  box-shadow: var(--shadow);
  transition: all 0.3s;
  display: flex;
  align-items: center;
  justify-content: center;
}

.btn-control:hover {
  transform: translateY(-3px);
  box-shadow: var(--shadow-lg);
}

/* =============== ESTAT√çSTICAS =============== */
.stats-bar {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}

.stat-card {
  background: var(--card-bg);
  padding: 25px;
  border-radius: 20px;
  box-shadow: var(--shadow);
  text-align: center;
  transition: all 0.3s;
}

.stat-card:hover {
  transform: translateY(-5px);
  box-shadow: var(--shadow-lg);
}

.stat-number {
  font-size: 2.5em;
  font-weight: 700;
  color: var(--primary);
  margin-bottom: 5px;
}

.stat-label {
  font-size: 0.9em;
  color: var(--text-secondary);
  font-weight: 500;
}

.stat-icon {
  font-size: 2em;
  margin-bottom: 10px;
}

/* =============== CARD DE ANIVERS√ÅRIO =============== */
.birthday-card {
  background: linear-gradient(135deg, #ec4899 0%, #f43f5e 100%);
  padding: 30px;
  border-radius: 25px;
  box-shadow: var(--shadow-lg);
  margin-bottom: 30px;
  color: white;
  animation: pulseGlow 2s ease-in-out infinite;
  position: relative;
  overflow: hidden;
  display: none;
}

.birthday-card.show {
  display: block;
}

.birthday-card::before {
  content: 'üéÇ';
  position: absolute;
  font-size: 15em;
  top: -50px;
  right: -50px;
  opacity: 0.1;
  animation: rotate 20s linear infinite;
}

@keyframes pulseGlow {
  0%, 100% {
    box-shadow: 0 20px 60px rgba(236, 72, 153, 0.3);
  }
  50% {
    box-shadow: 0 20px 80px rgba(236, 72, 153, 0.5);
  }
}

@keyframes rotate {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

.birthday-header {
  display: flex;
  align-items: center;
  gap: 15px;
  margin-bottom: 20px;
  position: relative;
  z-index: 1;
}

.birthday-icon {
  font-size: 3em;
  animation: bounce 1s ease-in-out infinite;
}

@keyframes bounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-10px); }
}

.birthday-title {
  font-size: 1.5em;
  font-weight: 700;
  text-shadow: 0 2px 10px rgba(0,0,0,0.2);
}

.birthday-content {
  display: flex;
  align-items: center;
  justify-content: space-between;
  flex-wrap: wrap;
  gap: 20px;
  position: relative;
  z-index: 1;
}

.birthday-info {
  flex: 1;
  min-width: 250px;
}

.birthday-name {
  font-size: 2em;
  font-weight: 700;
  margin-bottom: 10px;
  text-shadow: 0 2px 10px rgba(0,0,0,0.2);
}

.birthday-details {
  font-size: 1.1em;
  opacity: 0.95;
  line-height: 1.8;
}

.birthday-details div {
  margin: 5px 0;
}

.birthday-countdown {
  background: rgba(255,255,255,0.2);
  padding: 25px 35px;
  border-radius: 20px;
  text-align: center;
  backdrop-filter: blur(10px);
  min-width: 180px;
}

.countdown-number {
  font-size: 4em;
  font-weight: 900;
  line-height: 1;
  margin-bottom: 5px;
  text-shadow: 0 4px 15px rgba(0,0,0,0.3);
}

.countdown-label {
  font-size: 1em;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 2px;
  opacity: 0.9;
}

.birthday-urgent {
  animation: urgentPulse 1s ease-in-out infinite;
}

@keyframes urgentPulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.02); }
}

/* =============== GR√ÅFICO E LEMBRETES =============== */
.chart-container, .lembretes-container {
  background: var(--card-bg);
  padding: 30px;
  border-radius: 25px;
  box-shadow: var(--shadow-lg);
  margin-bottom: 30px;
}

.chart-title {
  font-size: 1.5em;
  font-weight: 700;
  color: var(--text-color);
  margin-bottom: 20px;
  text-align: center;
}

.lembrete-item {
  background: var(--input-bg);
  padding: 15px;
  border-radius: 12px;
  margin-bottom: 10px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-left: 4px solid var(--primary);
}

.lembrete-info h4 {
  color: var(--text-color);
  margin-bottom: 5px;
}

.lembrete-info p {
  color: var(--text-secondary);
  font-size: 0.9em;
}

/* =============== NAVEGA√á√ÉO =============== */
.nav-tabs {
  display: flex;
  gap: 15px;
  margin-bottom: 30px;
  background: rgba(255,255,255,0.1);
  padding: 10px;
  border-radius: 20px;
  backdrop-filter: blur(10px);
}

.nav-tab {
  flex: 1;
  padding: 15px 30px;
  background: transparent;
  border: 2px solid transparent;
  border-radius: 15px;
  color: white;
  font-size: 1em;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
}

.nav-tab:hover {
  background: rgba(255,255,255,0.1);
  transform: translateY(-2px);
}

.nav-tab.active {
  background: white;
  color: var(--primary);
  box-shadow: var(--shadow);
}

/* =============== CONTE√öDO =============== */
.content-section {
  display: none;
  animation: fadeInContent 0.5s ease;
}

.content-section.active {
  display: block;
}

@keyframes fadeInContent {
  from {
    opacity: 0;
    transform: scale(0.95);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

/* =============== FORMUL√ÅRIO =============== */
.form-card {
  background: var(--card-bg);
  padding: 40px;
  border-radius: 25px;
  box-shadow: var(--shadow-lg);
  margin-bottom: 30px;
}

.form-title {
  font-size: 2em;
  font-weight: 700;
  color: var(--text-color);
  margin-bottom: 30px;
  display: flex;
  align-items: center;
  gap: 15px;
}

.form-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  margin-bottom: 20px;
}

.form-group {
  display: flex;
  flex-direction: column;
}

.form-group label {
  font-size: 0.9em;
  font-weight: 600;
  color: var(--text-color);
  margin-bottom: 8px;
  display: flex;
  align-items: center;
  gap: 5px;
}

.required {
  color: var(--danger);
}

.form-group input,
.form-group select,
.form-group textarea {
  padding: 14px 18px;
  border: 2px solid var(--input-border);
  border-radius: 12px;
  font-size: 1em;
  font-family: 'Poppins', sans-serif;
  transition: all 0.3s;
  background: var(--input-bg);
  color: var(--text-color);
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
}

.form-group textarea {
  resize: vertical;
  min-height: 100px;
}

/* =============== BOT√ïES =============== */
.btn {
  padding: 16px 32px;
  border: none;
  border-radius: 12px;
  font-size: 1em;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  display: inline-flex;
  align-items: center;
  gap: 10px;
  justify-content: center;
  font-family: 'Poppins', sans-serif;
}

.btn-primary {
  background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
  color: white;
  box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 25px rgba(99, 102, 241, 0.5);
}

.btn-secondary {
  background: var(--gray);
  color: white;
}

.btn-success {
  background: var(--success);
  color: white;
}

.btn-danger {
  background: var(--danger);
  color: white;
}

.btn-sm {
  padding: 8px 16px;
  font-size: 0.85em;
}

/* =============== TABELA =============== */
.filter-bar {
  background: var(--card-bg);
  padding: 20px;
  border-radius: 15px;
  box-shadow: var(--shadow);
  margin-bottom: 20px;
  display: flex;
  gap: 15px;
  flex-wrap: wrap;
}

.filter-group {
  flex: 1;
  min-width: 200px;
}

.filter-group label {
  font-size: 0.9em;
  font-weight: 600;
  color: var(--text-color);
  margin-bottom: 5px;
  display: block;
}

.filter-group select {
  width: 100%;
  padding: 10px;
  border: 2px solid var(--input-border);
  border-radius: 8px;
  font-family: 'Poppins', sans-serif;
  background: var(--input-bg);
  color: var(--text-color);
}

.table-card {
  background: var(--card-bg);
  padding: 30px;
  border-radius: 25px;
  box-shadow: var(--shadow-lg);
  overflow: hidden;
}

.table-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 25px;
  flex-wrap: wrap;
  gap: 15px;
}

.table-title {
  font-size: 1.8em;
  font-weight: 700;
  color: var(--text-color);
}

.search-box {
  position: relative;
  width: 300px;
}

.search-box input {
  width: 100%;
  padding: 12px 20px 12px 45px;
  border: 2px solid var(--input-border);
  border-radius: 12px;
  font-size: 0.95em;
  font-family: 'Poppins', sans-serif;
  transition: all 0.3s;
  background: var(--input-bg);
  color: var(--text-color);
}

.search-icon {
  position: absolute;
  left: 15px;
  top: 50%;
  transform: translateY(-50%);
  color: var(--gray);
}

.table-wrapper {
  overflow-x: auto;
}

table {
  width: 100%;
  border-collapse: collapse;
}

thead {
  background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
  color: white;
}

thead th {
  padding: 15px;
  text-align: left;
  font-weight: 600;
  font-size: 0.9em;
}

tbody tr {
  border-bottom: 1px solid var(--input-border);
  transition: all 0.3s;
}

tbody tr:hover {
  background: var(--input-bg);
}

tbody td {
  padding: 15px;
  font-size: 0.9em;
  color: var(--text-color);
}

.badge-dias {
  background: var(--danger);
  color: white;
  padding: 4px 10px;
  border-radius: 12px;
  font-size: 0.75em;
  font-weight: 600;
  margin-left: 8px;
}

/* =============== CARDS =============== */
.cards-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 25px;
  margin-top: 20px;
}

.family-card {
  background: var(--card-bg);
  padding: 25px;
  border-radius: 20px;
  box-shadow: var(--shadow);
  transition: all 0.3s;
  cursor: pointer;
  position: relative;
  overflow: hidden;
}

.family-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 5px;
  background: linear-gradient(90deg, var(--primary), var(--secondary));
}

.family-card:hover {
  transform: translateY(-5px);
  box-shadow: var(--shadow-lg);
}

.card-avatar {
  width: 70px;
  height: 70px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.8em;
  font-weight: 700;
  margin: 0 auto 15px;
}

.card-name {
  font-size: 1.3em;
  font-weight: 700;
  color: var(--text-color);
  text-align: center;
  margin-bottom: 10px;
}

.card-info {
  font-size: 0.9em;
  color: var(--text-secondary);
  text-align: center;
  margin: 5px 0;
}

.card-badge {
  display: inline-block;
  padding: 6px 12px;
  background: var(--primary);
  color: white;
  border-radius: 20px;
  font-size: 0.8em;
  font-weight: 600;
  margin-top: 10px;
}

/* =============== ANIVERS√ÅRIOS =============== */
.aniversario-item {
  background: var(--card-bg);
  padding: 20px;
  border-radius: 15px;
  margin-bottom: 15px;
  display: flex;
  align-items: center;
  gap: 20px;
  box-shadow: var(--shadow);
  transition: all 0.3s;
  border-left: 5px solid var(--primary);
}

.aniversario-item:hover {
  transform: translateX(5px);
}

.aniversario-urgent {
  border-left-color: var(--danger);
}

.dark-mode .aniversario-urgent {
  background: rgba(239, 68, 68, 0.1);
}

.aniversario-icon {
  font-size: 3em;
}

.aniversario-info {
  flex: 1;
}

.aniversario-nome {
  font-size: 1.2em;
  font-weight: 700;
  color: var(--text-color);
  margin-bottom: 5px;
}

.aniversario-dias {
  color: var(--text-secondary);
  font-size: 0.95em;
}

/* =============== MODAL =============== */
.modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.7);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 9999;
  backdrop-filter: blur(5px);
}

.modal.active {
  display: flex;
}

.modal-content {
  background: var(--card-bg);
  padding: 40px;
  border-radius: 25px;
  max-width: 700px;
  width: 90%;
  max-height: 90vh;
  overflow-y: auto;
  position: relative;
  animation: modalSlideIn 0.3s ease;
}

@keyframes modalSlideIn {
  from {
    opacity: 0;
    transform: translateY(-50px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.modal-close {
  position: absolute;
  top: 20px;
  right: 20px;
  font-size: 2em;
  color: var(--gray);
  cursor: pointer;
  transition: all 0.3s;
}

.modal-close:hover {
  color: var(--danger);
  transform: rotate(90deg);
}

.modal-header {
  text-align: center;
  margin-bottom: 30px;
}

.modal-avatar {
  width: 100px;
  height: 100px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2.5em;
  font-weight: 700;
  margin: 0 auto 15px;
}

.modal-nome {
  font-size: 2em;
  font-weight: 700;
  color: var(--text-color);
  margin-bottom: 5px;
}

.modal-parentesco {
  color: var(--text-secondary);
  font-size: 1.1em;
}

.info-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}

.info-item {
  padding: 15px;
  background: var(--input-bg);
  border-radius: 12px;
  border-left: 4px solid var(--primary);
}

.info-label {
  font-size: 0.85em;
  color: var(--text-secondary);
  font-weight: 600;
  margin-bottom: 5px;
}

.info-value {
  font-size: 1.05em;
  color: var(--text-color);
  font-weight: 500;
}

.modal-actions {
  display: flex;
  gap: 15px;
  justify-content: center;
}

/* =============== NOTIFICA√á√ÉO =============== */
.notification {
  position: fixed;
  top: 20px;
  right: 20px;
  background: var(--card-bg);
  padding: 20px 25px;
  border-radius: 15px;
  box-shadow: var(--shadow-lg);
  display: none;
  align-items: center;
  gap: 15px;
  z-index: 10001;
  min-width: 300px;
  animation: slideInRight 0.5s ease;
}

@keyframes slideInRight {
  from {
    opacity: 0;
    transform: translateX(100px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

.notification.show {
  display: flex;
}

.notification-icon {
  font-size: 2em;
}

.notification-content {
  flex: 1;
}

.notification-title {
  font-weight: 700;
  color: var(--text-color);
  margin-bottom: 5px;
}

.notification-message {
  font-size: 0.9em;
  color: var(--text-secondary);
}

.notification-close {
  cursor: pointer;
  color: var(--gray);
  font-size: 1.5em;
}

.notification.success {
  border-left: 5px solid var(--success);
}

.notification.error {
  border-left: 5px solid var(--danger);
}

.notification.info {
  border-left: 5px solid var(--primary);
}

/* =============== LOADING OVERLAY =============== */
.loading-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.7);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 9998;
  backdrop-filter: blur(5px);
}

.loading-overlay.show {
  display: flex;
}

.loading-content {
  text-align: center;
  color: white;
}

.loading-spinner {
  width: 80px;
  height: 80px;
  border: 6px solid rgba(255,255,255,0.3);
  border-top-color: white;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 0 auto 20px;
}

/* =============== CONFETE =============== */
.confete {
  position: fixed;
  width: 10px;
  height: 10px;
  z-index: 9999;
  pointer-events: none;
}

/* =============== RESPONSIVO =============== */
@media (max-width: 768px) {
  .header h1 {
    font-size: 2.5em;
  }
  
  .nav-tabs {
    flex-direction: column;
  }
  
  .form-grid {
    grid-template-columns: 1fr;
  }
  
  .birthday-content {
    flex-direction: column;
    text-align: center;
  }
  
  .filter-bar {
    flex-direction: column;
  }
  
  .control-buttons {
    flex-direction: column;
  }
  
  .search-box {
    width: 100%;
  }
}

@media print {
  .nav-tabs,
  .birthday-card,
  .loading-screen,
  button,
  .filter-bar,
  .btn,
  .control-buttons {
    display: none !important;
  }
  
  body {
    background: white !important;
  }
}
</style>
</head>

<body>

<!-- TELA DE LOGIN -->
<div class="login-screen" id="loginScreen">
  <div class="login-box">
    <div class="login-logo">üîê</div>
    <h1 class="login-title">Acesso Restrito</h1>
    <p class="login-subtitle">Digite a senha para acessar o sistema</p>
    
    <form class="login-form" onsubmit="fazerLogin(event)">
      <input 
        type="password" 
        id="senhaInput" 
        class="login-input" 
        placeholder="Digite a senha"
        autocomplete="off"
        required
      >
      
      <div class="login-error" id="loginError">
        ‚ùå Senha incorreta! Tente novamente.
      </div>
      
      <button type="submit" class="btn btn-primary" style="width: 100%;">
        üîì Entrar no Sistema
      </button>
    </form>
    
    <p style="margin-top: 30px; font-size: 0.85em; color: var(--text-secondary);">
      üí° Senha padr√£o: <strong>familia2024</strong><br>
      <small>(Altere a senha na linha 1787 do c√≥digo)</small>
    </p>
  </div>
</div>

<!-- LOADING INICIAL -->
<div class="loading-screen">
  <div class="logo-animation">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</div>
  <div class="loading-text">CARREGANDO SISTEMA</div>
  <div class="spinner"></div>
</div>

<!-- LOADING OVERLAY -->
<div class="loading-overlay" id="loadingOverlay">
  <div class="loading-content">
    <div class="loading-spinner"></div>
    <p>Processando...</p>
  </div>
</div>

<!-- NOTIFICA√á√ÉO -->
<div class="notification" id="notification">
  <div class="notification-icon">‚úì</div>
  <div class="notification-content">
    <div class="notification-title">Sucesso</div>
    <div class="notification-message">Opera√ß√£o conclu√≠da</div>
  </div>
  <div class="notification-close" onclick="fecharNotificacao()">√ó</div>
</div>

<!-- BOT√ïES DE CONTROLE -->
<div class="control-buttons">
  <button class="btn-control" onclick="toggleDarkMode()" title="Modo Escuro/Claro">
    <span id="iconMode">üåô</span>
  </button>
  <button class="btn-control" onclick="sair()" title="Sair do Sistema">
    üö™
  </button>
</div>

<!-- CONTAINER PRINCIPAL -->
<div class="container" id="mainContainer" style="display: none;">
  
  <!-- HEADER -->
  <div class="header">
    <h1>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Sistema Familiar</h1>
    <p>Gerencie sua fam√≠lia de forma simples e organizada</p>
  </div>
  
  <!-- ESTAT√çSTICAS -->
  <div class="stats-bar">
    <div class="stat-card">
      <div class="stat-icon">üë•</div>
      <div class="stat-number" id="statTotal">0</div>
      <div class="stat-label">Total de Familiares</div>
    </div>
    
    <div class="stat-card">
      <div class="stat-icon">‚úÖ</div>
      <div class="stat-number" id="statAtivos">0</div>
      <div class="stat-label">Ativos</div>
    </div>
    
    <div class="stat-card">
      <div class="stat-icon">üìä</div>
      <div class="stat-number" id="statIdadeMedia">0</div>
      <div class="stat-label">Idade M√©dia</div>
    </div>
    
    <div class="stat-card">
      <div class="stat-icon">üéÇ</div>
      <div class="stat-number" id="statAniversarios">0</div>
      <div class="stat-label">Anivers√°rios Pr√≥ximos</div>
    </div>
  </div>
  
  <!-- CARD DE ANIVERS√ÅRIO MAIS PR√ìXIMO -->
  <div id="birthdayCard" class="birthday-card">
    <div class="birthday-header">
      <div class="birthday-icon">üéâ</div>
      <div class="birthday-title">Pr√≥ximo Anivers√°rio</div>
    </div>
    
    <div class="birthday-content">
      <div class="birthday-info">
        <div class="birthday-name" id="bdayName">-</div>
        <div class="birthday-details">
          <div>üìÖ <span id="bdayDate">-</span></div>
          <div>üë§ <span id="bdayRelation">-</span></div>
          <div>üéÇ Far√° <span id="bdayAge">-</span> anos</div>
        </div>
      </div>
      
      <div class="birthday-countdown">
        <div class="countdown-number" id="bdayCountdown">0</div>
        <div class="countdown-label" id="bdayLabel">DIAS</div>
      </div>
    </div>
  </div>
  
  <!-- GR√ÅFICO DE ANIVERS√ÅRIOS POR M√äS -->
  <div class="chart-container">
    <h3 class="chart-title">üìä Anivers√°rios por M√™s</h3>
    <canvas id="chartAniversarios"></canvas>
  </div>
  
  <!-- LEMBRETES -->
  <div class="lembretes-container">
    <h3 class="chart-title">üîî Meus Lembretes</h3>
    
    <div style="margin-bottom: 20px;">
      <button class="btn btn-primary" onclick="abrirModalLembrete()">
        ‚ûï Adicionar Lembrete
      </button>
    </div>
    
    <div id="lembretesLista"></div>
  </div>
  
  <!-- NAVEGA√á√ÉO -->
  <div class="nav-tabs">
    <button class="nav-tab active" onclick="mudarAba('cadastro')">
      ‚úèÔ∏è Cadastro
    </button>
    <button class="nav-tab" onclick="mudarAba('lista')">
      üìã Lista
    </button>
    <button class="nav-tab" onclick="mudarAba('cards')">
      üé¥ Cards
    </button>
    <button class="nav-tab" onclick="mudarAba('aniversarios')">
      üéÇ Anivers√°rios
    </button>
  </div>
  
  <!-- ABA CADASTRO -->
  <div id="cadastro" class="content-section active">
    <div class="form-card">
      <div class="form-title">
        <span>üë§</span>
        <span id="formTitleText">Cadastrar Novo Familiar</span>
      </div>
      
      <form id="familyForm" onsubmit="salvar(event)">
        <input type="hidden" id="editId">
        
        <div class="form-grid">
          <div class="form-group">
            <label>Nome Completo <span class="required">*</span></label>
            <input type="text" id="nome" required>
          </div>
          
          <div class="form-group">
            <label>Parentesco <span class="required">*</span></label>
            <select id="parentesco" required>
              <option value="">Selecione</option>
              <option value="Pai">Pai</option>
              <option value="M√£e">M√£e</option>
              <option value="Filho(a)">Filho(a)</option>
              <option value="Irm√£o(√£)">Irm√£o(√£)</option>
              <option value="Av√¥(√≥)">Av√¥(√≥)</option>
              <option value="Tio(a)">Tio(a)</option>
              <option value="Primo(a)">Primo(a)</option>
              <option value="Sobrinho(a)">Sobrinho(a)</option>
              <option value="C√¥njuge">C√¥njuge</option>
              <option value="Outro">Outro</option>
            </select>
          </div>
          
          <div class="form-group">
            <label>CPF</label>
            <input type="text" id="cpf" maxlength="14" placeholder="000.000.000-00">
          </div>
          
          <div class="form-group">
            <label>Data de Nascimento</label>
            <input type="date" id="nascimento">
          </div>
          
          <div class="form-group">
            <label>Cart√£o SUS</label>
            <input type="text" id="cartaoSus" maxlength="18">
          </div>
          
          <div class="form-group">
            <label>Telefone</label>
            <input type="tel" id="telefone" placeholder="(00) 00000-0000">
          </div>
          
          <div class="form-group">
            <label>Email</label>
            <input type="email" id="email">
          </div>
          
          <div class="form-group">
            <label>Profiss√£o</label>
            <input type="text" id="profissao">
          </div>
          
          <div class="form-group">
            <label>Estado Civil</label>
            <select id="estadoCivil">
              <option value="">Selecione</option>
              <option value="Solteiro(a)">Solteiro(a)</option>
              <option value="Casado(a)">Casado(a)</option>
              <option value="Divorciado(a)">Divorciado(a)</option>
              <option value="Vi√∫vo(a)">Vi√∫vo(a)</option>
              <option value="Uni√£o Est√°vel">Uni√£o Est√°vel</option>
            </select>
          </div>
          
          <div class="form-group">
            <label>Escolaridade</label>
            <select id="escolaridade">
              <option value="">Selecione</option>
              <option value="Fundamental Incompleto">Fundamental Incompleto</option>
              <option value="Fundamental Completo">Fundamental Completo</option>
              <option value="M√©dio Incompleto">M√©dio Incompleto</option>
              <option value="M√©dio Completo">M√©dio Completo</option>
              <option value="Superior Incompleto">Superior Incompleto</option>
              <option value="Superior Completo">Superior Completo</option>
              <option value="P√≥s-gradua√ß√£o">P√≥s-gradua√ß√£o</option>
            </select>
          </div>
          
          <div class="form-group">
            <label>Tipo Sangu√≠neo</label>
            <select id="tipoSanguineo">
              <option value="">Selecione</option>
              <option value="A+">A+</option>
              <option value="A-">A-</option>
              <option value="B+">B+</option>
              <option value="B-">B-</option>
              <option value="AB+">AB+</option>
              <option value="AB-">AB-</option>
              <option value="O+">O+</option>
              <option value="O-">O-</option>
            </select>
          </div>
          
          <div class="form-group">
            <label>Nacionalidade</label>
            <input type="text" id="nacionalidade" value="Brasileira">
          </div>
        </div>
        
        <div class="form-group">
          <label>Endere√ßo Completo</label>
          <input type="text" id="endereco">
        </div>
        
        <div class="form-group">
          <label>Observa√ß√µes</label>
          <textarea id="observacoes"></textarea>
        </div>
        
        <div style="display: flex; gap: 15px; margin-top: 30px;">
          <button type="submit" class="btn btn-primary" style="flex: 1;">
            <span id="btnSubmitText">üíæ Cadastrar Familiar</span>
          </button>
          <button type="button" class="btn btn-secondary" id="btnCancelar" onclick="cancelarEdicao()" style="display: none;">
            ‚ùå Cancelar
          </button>
        </div>
      </form>
    </div>
  </div>
  
  <!-- ABA LISTA -->
  <div id="lista" class="content-section">
    
    <div class="filter-bar">
      <div class="filter-group">
        <label>Filtrar por Parentesco</label>
        <select id="filterParentesco" onchange="aplicarFiltros()">
          <option value="">Todos</option>
          <option value="Pai">Pai</option>
          <option value="M√£e">M√£e</option>
          <option value="Filho(a)">Filho(a)</option>
          <option value="Irm√£o(√£)">Irm√£o(√£)</option>
        </select>
      </div>
      
      <div class="filter-group">
        <label>Filtrar por Estado Civil</label>
        <select id="filterEstadoCivil" onchange="aplicarFiltros()">
          <option value="">Todos</option>
          <option value="Solteiro(a)">Solteiro(a)</option>
          <option value="Casado(a)">Casado(a)</option>
        </select>
      </div>
      
      <div class="filter-group">
        <button class="btn btn-secondary" onclick="limparFiltros()" style="margin-top: 26px; width: 100%;">
          üîÑ Limpar
        </button>
      </div>
    </div>
    
    <div style="margin-bottom: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
      <button class="btn btn-primary" onclick="exportarExcel()">üìä Exportar</button>
      <button class="btn btn-success" onclick="sincronizarDados()">üîÑ Sincronizar</button>
    </div>
    
    <div class="table-card">
      <div class="table-header">
        <div class="table-title">üìã Lista de Familiares</div>
        <div class="search-box">
          <span class="search-icon">üîç</span>
          <input type="text" id="searchInput" placeholder="Pesquisar...">
        </div>
      </div>
      
      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th>Nome</th>
              <th>Parentesco</th>
              <th>Nascimento</th>
              <th>Idade</th>
              <th>Telefone</th>
              <th>A√ß√µes</th>
            </tr>
          </thead>
          <tbody id="tableBody">
            <tr>
              <td colspan="6" style="text-align: center; padding: 40px;">
                Nenhum familiar cadastrado
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
  
  <!-- ABA CARDS -->
  <div id="cards" class="content-section">
    <div class="table-card">
      <div class="table-header">
        <div class="table-title">üé¥ Familiares em Cards</div>
      </div>
      <div class="cards-grid" id="cardsGrid"></div>
    </div>
  </div>
  
  <!-- ABA ANIVERS√ÅRIOS -->
  <div id="aniversarios" class="content-section">
    <div class="table-card">
      <div class="table-header">
        <div class="table-title">üéÇ Anivers√°rios Pr√≥ximos</div>
      </div>
      <div id="aniversariosList"></div>
    </div>
  </div>
  
</div>

<!-- MODAL DETALHES -->
<div class="modal" id="modal" onclick="fecharModal()">
  <div class="modal-content" onclick="event.stopPropagation()">
    <span class="modal-close" onclick="fecharModal()">√ó</span>
    
    <div class="modal-header">
      <div class="modal-avatar" id="modalAvatar">JD</div>
      <div class="modal-nome" id="modalNome">Nome</div>
      <div class="modal-parentesco" id="modalParentesco">Parentesco</div>
    </div>
    
    <div class="info-grid" id="modalBody"></div>
    
    <div class="modal-actions">
      <button class="btn btn-primary" onclick="editarDoModal()">‚úèÔ∏è Editar</button>
      <button class="btn btn-danger" onclick="deletarDoModal()">üóëÔ∏è Excluir</button>
    </div>
  </div>
</div>

<!-- MODAL LEMBRETE -->
<div class="modal" id="modalLembrete" onclick="fecharModalLembrete()">
  <div class="modal-content" onclick="event.stopPropagation()">
    <span class="modal-close" onclick="fecharModalLembrete()">√ó</span>
    
    <h2 style="color: var(--text-color); margin-bottom: 20px;">üîî Novo Lembrete</h2>
    
    <form onsubmit="salvarLembrete(event)">
      <div class="form-group" style="margin-bottom: 15px;">
        <label>Familiar</label>
        <select id="lembreteFamiliar" required style="width: 100%; padding: 12px; border: 2px solid var(--input-border); border-radius: 8px; background: var(--input-bg); color: var(--text-color);">
          <option value="">Selecione</option>
        </select>
      </div>
      
      <div class="form-group" style="margin-bottom: 15px;">
        <label>Mensagem</label>
        <textarea id="lembreteMensagem" required style="width: 100%; padding: 12px; border: 2px solid var(--input-border); border-radius: 8px; background: var(--input-bg); color: var(--text-color); min-height: 80px;"></textarea>
      </div>
      
      <div class="form-group" style="margin-bottom: 20px;">
        <label>Data</label>
        <input type="date" id="lembreteData" required style="width: 100%; padding: 12px; border: 2px solid var(--input-border); border-radius: 8px; background: var(--input-bg); color: var(--text-color);">
      </div>
      
      <button type="submit" class="btn btn-primary" style="width: 100%;">
        üíæ Salvar Lembrete
      </button>
    </form>
  </div>
</div>

<script>
// =============== CONFIGURA√á√ÉO ===============
const API_URL = 'https://script.google.com/macros/s/AKfycbwMHC_vZjc-vm8qKXWEEvyLr6Qvpfq4YaoRWxdWSnWz1_jQyAhT7s_S9flm35CiKwUjxw/exec';

// üîê ALTERE A SENHA AQUI:
const SENHA_SISTEMA = '********';

let familiares = [];
let familiarAtual = null;
let lembretes = JSON.parse(localStorage.getItem('lembretes') || '[]');
let chartInstance = null;

// =============== AUTENTICA√á√ÉO ===============
function verificarAutenticacao() {
  const autenticado = sessionStorage.getItem('autenticado');
  if (autenticado === 'true') {
    document.getElementById('loginScreen').classList.add('hidden');
    document.getElementById('mainContainer').style.display = 'block';
    return true;
  }
  return false;
}

function fazerLogin(e) {
  e.preventDefault();
  const senha = document.getElementById('senhaInput').value;
  const erro = document.getElementById('loginError');
  
  if (senha === SENHA_SISTEMA) {
    sessionStorage.setItem('autenticado', 'true');
    document.getElementById('loginScreen').classList.add('hidden');
    document.getElementById('mainContainer').style.display = 'block';
    mostrarNotificacao('Login realizado com sucesso!', 'success');
  } else {
    erro.classList.add('show');
    document.getElementById('senhaInput').value = '';
    setTimeout(() => erro.classList.remove('show'), 3000);
  }
}

function sair() {
  if (confirm('Deseja realmente sair do sistema?')) {
    sessionStorage.removeItem('autenticado');
    location.reload();
  }
}

// =============== MODO ESCURO ===============
function toggleDarkMode() {
  document.body.classList.toggle('dark-mode');
  const isDark = document.body.classList.contains('dark-mode');
  localStorage.setItem('darkMode', isDark);
  document.getElementById('iconMode').textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
}

window.addEventListener('load', () => {
  if (localStorage.getItem('darkMode') === 'true') {
    document.body.classList.add('dark-mode');
    document.getElementById('iconMode').textContent = '‚òÄÔ∏è';
  }
});

// =============== M√ÅSCARAS ===============
document.getElementById('cpf')?.addEventListener('input', function(e) {
  let valor = e.target.value.replace(/\D/g, '');
  valor = valor.replace(/(\d{3})(\d)/, '$1.$2');
  valor = valor.replace(/(\d{3})(\d)/, '$1.$2');
  valor = valor.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
  e.target.value = valor;
});

document.getElementById('telefone')?.addEventListener('input', function(e) {
  let valor = e.target.value.replace(/\D/g, '');
  if (valor.length <= 10) {
    valor = valor.replace(/(\d{2})(\d)/, '($1) $2');
    valor = valor.replace(/(\d{4})(\d)/, '$1-$2');
  } else {
    valor = valor.replace(/(\d{2})(\d)/, '($1) $2');
    valor = valor.replace(/(\d{5})(\d)/, '$1-$2');
  }
  e.target.value = valor;
});

// =============== NAVEGA√á√ÉO ===============
function mudarAba(aba) {
  document.querySelectorAll('.content-section').forEach(section => {
    section.classList.remove('active');
  });
  document.querySelectorAll('.nav-tab').forEach(tab => {
    tab.classList.remove('active');
  });
  document.getElementById(aba).classList.add('active');
  event.target.classList.add('active');
  
  if (aba === 'lista') carregarTabela();
  if (aba === 'cards') carregarCards();
  if (aba === 'aniversarios') carregarAniversarios();
}

// =============== NOTIFICA√á√ÉO ===============
function mostrarNotificacao(mensagem, tipo = 'success', duracao = 5000) {
  const notif = document.getElementById('notification');
  const icon = notif.querySelector('.notification-icon');
  const title = notif.querySelector('.notification-title');
  const message = notif.querySelector('.notification-message');
  
  notif.className = 'notification show ' + tipo;
  
  if (tipo === 'success') {
    icon.textContent = '‚úì';
    title.textContent = 'Sucesso';
  } else if (tipo === 'error') {
    icon.textContent = '‚úó';
    title.textContent = 'Erro';
  } else if (tipo === 'info') {
    icon.textContent = '‚Ñπ';
    title.textContent = 'Informa√ß√£o';
  }
  
  message.textContent = mensagem;
  setTimeout(() => notif.classList.remove('show'), duracao);
}

function fecharNotificacao() {
  document.getElementById('notification').classList.remove('show');
}

// =============== CONFETE ===============
function criarConfete() {
  const cores = ['#FFD700', '#FF69B4', '#00CED1', '#FF6347', '#7FFF00', '#FF1493'];
  
  for (let i = 0; i < 100; i++) {
    const confete = document.createElement('div');
    confete.className = 'confete';
    confete.style.left = Math.random() * 100 + '%';
    confete.style.top = '-10px';
    confete.style.backgroundColor = cores[Math.floor(Math.random() * cores.length)];
    confete.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
    
    document.body.appendChild(confete);
    
    const animacao = confete.animate([
      { transform: 'translateY(0) rotate(0deg)', opacity: 1 },
      { transform: `translateY(${window.innerHeight + 50}px) rotate(${Math.random() * 720}deg)`, opacity: 0 }
    ], {
      duration: Math.random() * 3000 + 2000,
      easing: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)'
    });
    
    animacao.onfinish = () => confete.remove();
  }
}

// =============== CARREGAR DADOS ===============
async function carregar() {
  try {
    const res = await fetch(API_URL + '?acao=listar');
    const dados = await res.json();
    
    if (dados && dados.length > 1) {
      familiares = [];
      
      for (let i = 1; i < dados.length; i++) {
        const linha = dados[i];
        familiares.push({
          id: linha[0],
          nome: linha[1],
          parentesco: linha[2],
          cpf: linha[3],
          nascimento: linha[4],
          idade: linha[5],
          cartaoSus: linha[6],
          telefone: linha[7],
          email: linha[8],
          profissao: linha[9],
          estadoCivil: linha[10],
          escolaridade: linha[11],
          tipoSanguineo: linha[12],
          nacionalidade: linha[13],
          endereco: linha[14],
          observacoes: linha[15],
          dataCadastro: linha[16],
          ultimaAtualizacao: linha[17],
          status: linha[18]
        });
      }
      
      atualizarSelectLembretes();
    }
  } catch (erro) {
    console.error('Erro ao carregar:', erro);
  }
}

// =============== CARREGAR ESTAT√çSTICAS ===============
async function carregarEstatisticas() {
  try {
    const res = await fetch(API_URL + '?acao=estatisticas');
    const stats = await res.json();
    
    document.getElementById('statTotal').textContent = stats.total || 0;
    document.getElementById('statAtivos').textContent = stats.ativos || 0;
    document.getElementById('statIdadeMedia').textContent = stats.idadeMedia || 0;
    
    const resAniv = await fetch(API_URL + '?acao=aniversarios');
    const aniv = await resAniv.json();
    document.getElementById('statAniversarios').textContent = aniv.length || 0;
    
  } catch (erro) {
    console.error('Erro ao carregar estat√≠sticas:', erro);
  }
}

// =============== CARREGAR ANIVERS√ÅRIO MAIS PR√ìXIMO ===============
async function carregarAniversarioMaisProximo() {
  try {
    const res = await fetch(API_URL + '?acao=aniversarios');
    const aniversarios = await res.json();
    
    const card = document.getElementById('birthdayCard');
    
    if (!aniversarios || aniversarios.length === 0) {
      card.classList.remove('show');
      return;
    }
    
    const proximo = aniversarios[0];
    const dias = proximo.diasRestantes;
    
    document.getElementById('bdayName').textContent = proximo.nome;
    document.getElementById('bdayDate').textContent = formatarData(proximo.dataNascimento);
    document.getElementById('bdayRelation').textContent = proximo.parentesco;
    document.getElementById('bdayAge').textContent = proximo.idadeQueFara;
    document.getElementById('bdayCountdown').textContent = dias;
    document.getElementById('bdayLabel').textContent = dias === 1 ? 'DIA' : 'DIAS';
    
    if (dias <= 2) {
      card.classList.add('birthday-urgent');
    }
    
    card.classList.add('show');
    
  } catch (erro) {
    console.log('Erro ao carregar anivers√°rio:', erro);
  }
}

// =============== GR√ÅFICO DE ANIVERS√ÅRIOS POR M√äS ===============
function criarGraficoAniversarios() {
  const meses = Array(12).fill(0);
  
  familiares.forEach(f => {
    if (f.nascimento) {
      const mes = new Date(f.nascimento + 'T00:00:00').getMonth();
      meses[mes]++;
    }
  });
  
  const ctx = document.getElementById('chartAniversarios');
  if (!ctx) return;
  
  if (chartInstance) {
    chartInstance.destroy();
  }
  
  chartInstance = new Chart(ctx.getContext('2d'), {
    type: 'bar',
    data: {
      labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'],
      datasets: [{
        label: 'Anivers√°rios',
        data: meses,
        backgroundColor: '#6366f1',
        borderRadius: 8
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: true,
      plugins: {
        legend: { display: false }
      },
      scales: {
        y: {
          beginAtZero: true,
          ticks: { stepSize: 1 }
        }
      }
    }
  });
}

// =============== CONTADOR DE DIAS AT√â PR√ìXIMO ANIVERS√ÅRIO ===============
function diasAteAniversario(dataNasc) {
  if (!dataNasc) return null;
  
  const hoje = new Date();
  const nasc = new Date(dataNasc + 'T00:00:00');
  
  const proxAniv = new Date(hoje.getFullYear(), nasc.getMonth(), nasc.getDate());
  
  if (proxAniv < hoje) {
    proxAniv.setFullYear(hoje.getFullYear() + 1);
  }
  
  return Math.ceil((proxAniv - hoje) / (1000 * 60 * 60 * 24));
}

// =============== LEMBRETES ===============
function atualizarSelectLembretes() {
  const select = document.getElementById('lembreteFamiliar');
  if (!select) return;
  
  select.innerHTML = '<option value="">Selecione</option>';
  
  familiares.forEach(f => {
    const option = document.createElement('option');
    option.value = f.id;
    option.textContent = f.nome;
    select.appendChild(option);
  });
}

function abrirModalLembrete() {
  document.getElementById('modalLembrete').classList.add('active');
}

function fecharModalLembrete() {
  document.getElementById('modalLembrete').classList.remove('active');
  document.getElementById('lembreteFamiliar').value = '';
  document.getElementById('lembreteMensagem').value = '';
  document.getElementById('lembreteData').value = '';
}

function salvarLembrete(e) {
  e.preventDefault();
  
  const idFamiliar = document.getElementById('lembreteFamiliar').value;
  const mensagem = document.getElementById('lembreteMensagem').value;
  const data = document.getElementById('lembreteData').value;
  
  const familiar = familiares.find(f => f.id == idFamiliar);
  
  lembretes.push({
    id: Date.now(),
    idFamiliar: parseInt(idFamiliar),
    nomeFamiliar: familiar.nome,
    mensagem: mensagem,
    data: data,
    ativo: true
  });
  
  localStorage.setItem('lembretes', JSON.stringify(lembretes));
  
  mostrarNotificacao('Lembrete criado com sucesso!', 'success');
  fecharModalLembrete();
  carregarLembretes();
}

function carregarLembretes() {
  const lista = document.getElementById('lembretesLista');
  if (!lista) return;
  
  lista.innerHTML = '';
  
  if (lembretes.length === 0) {
    lista.innerHTML = `
      <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
        <p>Nenhum lembrete cadastrado</p>
      </div>
    `;
    return;
  }
  
  lembretes.sort((a, b) => new Date(a.data) - new Date(b.data));
  
  lembretes.forEach(l => {
    if (!l.ativo) return;
    
    const div = document.createElement('div');
    div.className = 'lembrete-item';
    
    const diasRestantes = Math.ceil((new Date(l.data) - new Date()) / (1000 * 60 * 60 * 24));
    
    div.innerHTML = `
      <div class="lembrete-info">
        <h4>${l.nomeFamiliar} - ${l.mensagem}</h4>
        <p>üìÖ ${formatarData(l.data)} ${diasRestantes >= 0 ? `(em ${diasRestantes} ${diasRestantes === 1 ? 'dia' : 'dias'})` : '(vencido)'}</p>
      </div>
      <div class="lembrete-actions">
        <button class="btn btn-danger btn-sm" onclick="deletarLembrete(${l.id})">üóëÔ∏è</button>
      </div>
    `;
    
    lista.appendChild(div);
  });
}

function deletarLembrete(id) {
  if (!confirm('Deseja excluir este lembrete?')) return;
  
  lembretes = lembretes.filter(l => l.id !== id);
  localStorage.setItem('lembretes', JSON.stringify(lembretes));
  carregarLembretes();
  mostrarNotificacao('Lembrete exclu√≠do!', 'success');
}

function verificarLembretes() {
  const hoje = new Date().toISOString().split('T')[0];
  
  lembretes.forEach(l => {
    if (l.ativo && l.data === hoje) {
      mostrarNotificacao(`üîî Lembrete: ${l.mensagem} (${l.nomeFamiliar})`, 'info', 10000);
      l.ativo = false;
    }
  });
  
  localStorage.setItem('lembretes', JSON.stringify(lembretes));
}

// =============== VERIFICAR ANIVERS√ÅRIOS DO DIA ===============
function verificarAniversariosHoje() {
  const hoje = new Date();
  
  const aniversariantesHoje = familiares.filter(f => {
    if (!f.nascimento) return false;
    const nasc = new Date(f.nascimento + 'T00:00:00');
    return nasc.getDate() === hoje.getDate() && nasc.getMonth() === hoje.getMonth();
  });
  
  if (aniversariantesHoje.length > 0) {
    criarConfete();
    aniversariantesHoje.forEach(f => {
      mostrarNotificacao(`üéÇüéâ Hoje √© anivers√°rio de ${f.nome}! Parab√©ns! üéâüéÇ`, 'success', 10000);
    });
  }
}

// =============== SALVAR ===============
async function salvar(e) {
  e.preventDefault();
  
  const editId = document.getElementById('editId').value;
  
  const dados = {
    acao: editId ? 'atualizar' : 'cadastrar',
    id: editId || undefined,
    nome: document.getElementById('nome').value,
    parentesco: document.getElementById('parentesco').value,
    cpf: document.getElementById('cpf').value,
    nascimento: document.getElementById('nascimento').value,
    cartaoSus: document.getElementById('cartaoSus').value,
    telefone: document.getElementById('telefone').value,
    email: document.getElementById('email').value,
    profissao: document.getElementById('profissao').value,
    estadoCivil: document.getElementById('estadoCivil').value,
    escolaridade: document.getElementById('escolaridade').value,
    tipoSanguineo: document.getElementById('tipoSanguineo').value,
    nacionalidade: document.getElementById('nacionalidade').value,
    endereco: document.getElementById('endereco').value,
    observacoes: document.getElementById('observacoes').value
  };
  
  const overlay = document.getElementById('loadingOverlay');
  overlay.classList.add('show');
  
  try {
    await fetch(API_URL, {
      method: 'POST',
      mode: 'no-cors',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify(dados)
    });
    
    mostrarNotificacao(editId ? 'Familiar atualizado!' : 'Familiar cadastrado!', 'success');
    
    document.getElementById('familyForm').reset();
    document.getElementById('editId').value = '';
    document.getElementById('formTitleText').textContent = 'Cadastrar Novo Familiar';
    document.getElementById('btnSubmitText').textContent = 'üíæ Cadastrar Familiar';
    document.getElementById('btnCancelar').style.display = 'none';
    
    setTimeout(async () => {
      await carregar();
      await carregarEstatisticas();
      await carregarAniversarioMaisProximo();
      criarGraficoAniversarios();
      overlay.classList.remove('show');
    }, 1500);
    
  } catch (erro) {
    overlay.classList.remove('show');
    mostrarNotificacao('Solicita√ß√£o enviada! Aguarde sincroniza√ß√£o.', 'info');
    setTimeout(async () => {
      await carregar();
      await carregarEstatisticas();
      await carregarAniversarioMaisProximo();
      criarGraficoAniversarios();
    }, 2000);
  }
}

// =============== TABELA ===============
function carregarTabela() {
  const tbody = document.getElementById('tableBody');
  if (!tbody) return;
  
  tbody.innerHTML = '';
  
  if (familiares.length === 0) {
    tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 40px;">Nenhum familiar cadastrado</td></tr>';
    return;
  }
  
  familiares.forEach(f => {
    const tr = document.createElement('tr');
    
    const dias = diasAteAniversario(f.nascimento);
    const badge = dias !== null && dias <= 30 ? `<span class="badge-dias">üéÇ ${dias}d</span>` : '';
    
    tr.innerHTML = `
      <td><strong>${f.nome}${badge}</strong></td>
      <td>${f.parentesco}</td>
      <td>${formatarData(f.nascimento) || '-'}</td>
      <td>${f.idade || '-'}</td>
      <td>${f.telefone || '-'}</td>
      <td>
        <button class="btn btn-success btn-sm" onclick="editar(${f.id})">‚úèÔ∏è</button>
        <button class="btn btn-danger btn-sm" onclick="deletar(${f.id})">üóëÔ∏è</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

// =============== CARDS ===============
function carregarCards() {
  const grid = document.getElementById('cardsGrid');
  if (!grid) return;
  
  grid.innerHTML = '';
  
  if (familiares.length === 0) {
    grid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 60px;"><h3>Nenhum familiar cadastrado</h3></div>';
    return;
  }
  
  familiares.forEach(f => {
    const card = document.createElement('div');
    card.className = 'family-card';
    card.onclick = () => visualizar(f.id);
    
    const iniciais = f.nome.split(' ').map(n => n[0]).join('').substring(0, 2);
    
    card.innerHTML = `
      <div class="card-avatar">${iniciais}</div>
      <div class="card-name">${f.nome}</div>
      <div class="card-info">üì± ${f.telefone || 'N√£o informado'}</div>
      <div class="card-info">üéÇ ${f.idade ? f.idade + ' anos' : 'N/A'}</div>
      <span class="card-badge">${f.parentesco}</span>
    `;
    
    grid.appendChild(card);
  });
}

// =============== ANIVERS√ÅRIOS ===============
async function carregarAniversarios() {
  const lista = document.getElementById('aniversariosList');
  if (!lista) return;
  
  lista.innerHTML = '';
  
  try {
    const res = await fetch(API_URL + '?acao=aniversarios');
    const aniversarios = await res.json();
    
    if (aniversarios.length === 0) {
      lista.innerHTML = '<div style="text-align: center; padding: 40px;"><h3>üéâ Nenhum anivers√°rio pr√≥ximo</h3></div>';
      return;
    }
    
    aniversarios.forEach(a => {
      const div = document.createElement('div');
      div.className = a.diasRestantes <= 2 ? 'aniversario-item aniversario-urgent' : 'aniversario-item';
      
      div.innerHTML = `
        <div class="aniversario-icon">üéÇ</div>
        <div class="aniversario-info">
          <div class="aniversario-nome">${a.nome} (${a.parentesco})</div>
          <div class="aniversario-dias">Faz anivers√°rio em ${a.diasRestantes} ${a.diasRestantes === 1 ? 'dia' : 'dias'} - Far√° ${a.idadeQueFara} anos</div>
        </div>
      `;
      
      lista.appendChild(div);
    });
    
  } catch (erro) {
    lista.innerHTML = '<div style="text-align: center; padding: 40px;"><p>Erro ao carregar</p></div>';
  }
}

// =============== MODAL ===============
function visualizar(id) {
  const familiar = familiares.find(f => f.id == id);
  if (!familiar) return;
  
  familiarAtual = familiar;
  
  const modal = document.getElementById('modal');
  const iniciais = familiar.nome.split(' ').map(n => n[0]).join('').substring(0, 2);
  
  document.getElementById('modalAvatar').textContent = iniciais;
  document.getElementById('modalNome').textContent = familiar.nome;
  document.getElementById('modalParentesco').textContent = familiar.parentesco;
  
  const modalBody = document.getElementById('modalBody');
  modalBody.innerHTML = `
    <div class="info-item">
      <div class="info-label">CPF</div>
      <div class="info-value">${familiar.cpf || 'N√£o informado'}</div>
    </div>
    <div class="info-item">
      <div class="info-label">Data de Nascimento</div>
      <div class="info-value">${formatarData(familiar.nascimento) || 'N√£o informado'}</div>
    </div>
    <div class="info-item">
      <div class="info-label">Idade</div>
      <div class="info-value">${familiar.idade ? familiar.idade + ' anos' : 'N/A'}</div>
    </div>
    <div class="info-item">
      <div class="info-label">Telefone</div>
      <div class="info-value">${familiar.telefone || 'N√£o informado'}</div>
    </div>
    <div class="info-item">
      <div class="info-label">Email</div>
      <div class="info-value">${familiar.email || 'N√£o informado'}</div>
    </div>
    <div class="info-item" style="grid-column: 1/-1;">
      <div class="info-label">Endere√ßo</div>
      <div class="info-value">${familiar.endereco || 'N√£o informado'}</div>
    </div>
  `;
  
  modal.classList.add('active');
}

function fecharModal() {
  document.getElementById('modal').classList.remove('active');
  familiarAtual = null;
}

function editarDoModal() {
  if (familiarAtual) {
    editar(familiarAtual.id);
    fecharModal();
  }
}

function deletarDoModal() {
  if (familiarAtual) {
    deletar(familiarAtual.id);
    fecharModal();
  }
}

// =============== EDITAR ===============
function editar(id) {
  const familiar = familiares.find(f => f.id == id);
  if (!familiar) return;
  
  document.getElementById('editId').value = familiar.id;
  document.getElementById('nome').value = familiar.nome;
  document.getElementById('parentesco').value = familiar.parentesco;
  document.getElementById('cpf').value = familiar.cpf;
  document.getElementById('nascimento').value = familiar.nascimento;
  document.getElementById('cartaoSus').value = familiar.cartaoSus;
  document.getElementById('telefone').value = familiar.telefone;
  document.getElementById('email').value = familiar.email;
  document.getElementById('profissao').value = familiar.profissao;
  document.getElementById('estadoCivil').value = familiar.estadoCivil;
  document.getElementById('escolaridade').value = familiar.escolaridade;
  document.getElementById('tipoSanguineo').value = familiar.tipoSanguineo;
  document.getElementById('nacionalidade').value = familiar.nacionalidade;
  document.getElementById('endereco').value = familiar.endereco;
  document.getElementById('observacoes').value = familiar.observacoes;
  
  document.getElementById('formTitleText').textContent = 'Editar Familiar';
  document.getElementById('btnSubmitText').textContent = 'üíæ Atualizar Familiar';
  document.getElementById('btnCancelar').style.display = 'block';
  
  mudarAba('cadastro');
}

function cancelarEdicao() {
  document.getElementById('editId').value = '';
  document.getElementById('formTitleText').textContent = 'Cadastrar Novo Familiar';
  document.getElementById('btnSubmitText').textContent = 'üíæ Cadastrar Familiar';
  document.getElementById('btnCancelar').style.display = 'none';
  document.getElementById('familyForm').reset();
}

// =============== DELETAR ===============
async function deletar(id) {
  if (!confirm('Tem certeza que deseja excluir?')) return;
  
  try {
    await fetch(API_URL, {
      method: 'POST',
      mode: 'no-cors',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ acao: 'deletar', id: id })
    });
    
    mostrarNotificacao('Familiar exclu√≠do!', 'success');
    
    setTimeout(async () => {
      await carregar();
      await carregarEstatisticas();
      await carregarAniversarioMaisProximo();
      criarGraficoAniversarios();
      carregarTabela();
    }, 1000);
    
  } catch (erro) {
    mostrarNotificacao('Solicita√ß√£o enviada!', 'info');
  }
}

// =============== SINCRONIZAR ===============
async function sincronizarDados() {
  mostrarNotificacao('Sincronizando...', 'info');
  
  await carregar();
  await carregarEstatisticas();
  await carregarAniversarioMaisProximo();
  criarGraficoAniversarios();
  carregarTabela();
  
  mostrarNotificacao('Dados sincronizados!', 'success');
}

// =============== FILTROS ===============
function aplicarFiltros() {
  const parentesco = document.getElementById('filterParentesco').value;
  const estadoCivil = document.getElementById('filterEstadoCivil').value;
  
  const linhas = document.querySelectorAll('#tableBody tr');
  
  linhas.forEach(linha => {
    let mostrar = true;
    const colunas = linha.querySelectorAll('td');
    
    if (colunas.length < 2) return;
    
    if (parentesco && !colunas[1].textContent.includes(parentesco)) mostrar = false;
    
    linha.style.display = mostrar ? '' : 'none';
  });
}

function limparFiltros() {
  document.getElementById('filterParentesco').value = '';
  document.getElementById('filterEstadoCivil').value = '';
  document.getElementById('searchInput').value = '';
  
  document.querySelectorAll('#tableBody tr').forEach(linha => {
    linha.style.display = '';
  });
}

// =============== PESQUISA ===============
document.getElementById('searchInput')?.addEventListener('input', function(e) {
  const termo = e.target.value.toLowerCase();
  const linhas = document.querySelectorAll('#tableBody tr');
  
  linhas.forEach(linha => {
    const texto = linha.textContent.toLowerCase();
    linha.style.display = texto.includes(termo) ? '' : 'none';
  });
});

// =============== EXPORTAR ===============
function exportarExcel() {
  let csv = 'Nome,Parentesco,CPF,Nascimento,Idade,Telefone,Email\n';
  
  familiares.forEach(f => {
    csv += `"${f.nome}","${f.parentesco}","${f.cpf || ''}","${formatarData(f.nascimento)}","${f.idade || ''}","${f.telefone || ''}","${f.email || ''}"\n`;
  });
  
  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.download = 'familias_' + new Date().getTime() + '.csv';
  link.click();
  
  mostrarNotificacao('Excel exportado!', 'success');
}

// =============== UTILIDADES ===============
function formatarData(data) {
  if (!data) return '';
  const d = new Date(data + 'T00:00:00');
  return d.toLocaleDateString('pt-BR');
}

// =============== INICIALIZAR ===============
async function inicializar() {
  if (!verificarAutenticacao()) return;
  
  await carregar();
  await carregarEstatisticas();
  await carregarAniversarioMaisProximo();
  criarGraficoAniversarios();
  carregarTabela();
  carregarLembretes();
  
  setTimeout(verificarAniversariosHoje, 4000);
  setTimeout(verificarLembretes, 5000);
}

setTimeout(() => {
  inicializar();
}, 3500);

setInterval(() => {
  if (document.getElementById('birthdayCard').classList.contains('show')) {
    carregarAniversarioMaisProximo();
  }
}, 60000);
</script>

</body>
</html>
